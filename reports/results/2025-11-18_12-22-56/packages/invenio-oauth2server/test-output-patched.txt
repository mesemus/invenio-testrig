lists of files in version control and sdist match
running extract_messages
extracting messages from invenio_oauth2server/__init__.py (encoding="utf-8")
extracting messages from invenio_oauth2server/admin.py (encoding="utf-8")
extracting messages from invenio_oauth2server/cli.py (encoding="utf-8")
extracting messages from invenio_oauth2server/config.py (encoding="utf-8")
extracting messages from invenio_oauth2server/decorators.py (encoding="utf-8")
extracting messages from invenio_oauth2server/errors.py (encoding="utf-8")
extracting messages from invenio_oauth2server/ext.py (encoding="utf-8")
extracting messages from invenio_oauth2server/forms.py (encoding="utf-8")
extracting messages from invenio_oauth2server/models.py (encoding="utf-8")
extracting messages from invenio_oauth2server/provider.py (encoding="utf-8")
extracting messages from invenio_oauth2server/proxies.py (encoding="utf-8")
extracting messages from invenio_oauth2server/scopes.py (encoding="utf-8")
extracting messages from invenio_oauth2server/utils.py (encoding="utf-8")
extracting messages from invenio_oauth2server/validators.py (encoding="utf-8")
extracting messages from invenio_oauth2server/alembic/12a88921ada2_create_oauth2server_tables.py (encoding="utf-8")
extracting messages from invenio_oauth2server/alembic/4e57407b8e4a_add_on_delete_cascade.py (encoding="utf-8")
extracting messages from invenio_oauth2server/alembic/aa546f2a8d2f_create_oauth2server_branch.py (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/authorize.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/base.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/errors.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/_macros.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/base.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/client_new.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/client_view.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/helpers.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/index.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/token_new.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/token_permission_view.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/invenio_oauth2server/settings/token_view.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/authorize.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/base.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/errors.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/_macros.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/base.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/client_new.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/client_view.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/helpers.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/index.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/token_new.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/token_permission_view.html (encoding="utf-8")
extracting messages from invenio_oauth2server/templates/semantic-ui/invenio_oauth2server/settings/token_view.html (encoding="utf-8")
extracting messages from invenio_oauth2server/theme/semantic/form_styling.py (encoding="utf-8")
extracting messages from invenio_oauth2server/views/__init__.py (encoding="utf-8")
extracting messages from invenio_oauth2server/views/server.py (encoding="utf-8")
extracting messages from invenio_oauth2server/views/settings.py (encoding="utf-8")
writing PO template file to /dev/null
 postgresql Pulling 
 b0a0cf830b12 Pulling fs layer 
 dda3d8fbd5ed Pulling fs layer 
 283a477db7bb Pulling fs layer 
 91d2729fa4d5 Pulling fs layer 
 9739ced65621 Pulling fs layer 
 ae3bb1b347a4 Pulling fs layer 
 f8406d9c00ea Pulling fs layer 
 c199bff16b05 Pulling fs layer 
 e0d55fdb4d15 Pulling fs layer 
 c1cb13b19080 Pulling fs layer 
 873532e5f8c7 Pulling fs layer 
 050d9f8c3b1c Pulling fs layer 
 710e142705f8 Pulling fs layer 
 cb628c265f09 Pulling fs layer 
 9739ced65621 Waiting 
 ae3bb1b347a4 Waiting 
 f8406d9c00ea Waiting 
 c199bff16b05 Waiting 
 e0d55fdb4d15 Waiting 
 c1cb13b19080 Waiting 
 873532e5f8c7 Waiting 
 050d9f8c3b1c Waiting 
 710e142705f8 Waiting 
 cb628c265f09 Waiting 
 91d2729fa4d5 Waiting 
 283a477db7bb Downloading [>                                                  ]  45.95kB/4.533MB
 b0a0cf830b12 Downloading [>                                                  ]  299.9kB/29.15MB
 283a477db7bb Verifying Checksum 
 283a477db7bb Download complete 
 b0a0cf830b12 Downloading [===================================>               ]  20.56MB/29.15MB
 b0a0cf830b12 Verifying Checksum 
 b0a0cf830b12 Download complete 
 b0a0cf830b12 Extracting [>                                                  ]  294.9kB/29.15MB
 dda3d8fbd5ed Downloading [===========================================>       ]  1.009kB/1.165kB
 dda3d8fbd5ed Downloading [==================================================>]  1.165kB/1.165kB
 dda3d8fbd5ed Verifying Checksum 
 dda3d8fbd5ed Download complete 
 91d2729fa4d5 Downloading [>                                                  ]  14.62kB/1.45MB
 b0a0cf830b12 Extracting [===========>                                       ]  6.783MB/29.15MB
 91d2729fa4d5 Verifying Checksum 
 91d2729fa4d5 Download complete 
 9739ced65621 Downloading [>                                                  ]   84.3kB/8.069MB
 ae3bb1b347a4 Downloading [>                                                  ]  13.25kB/1.196MB
 b0a0cf830b12 Extracting [=================>                                 ]  10.32MB/29.15MB
 9739ced65621 Verifying Checksum 
 9739ced65621 Download complete 
 ae3bb1b347a4 Verifying Checksum 
 ae3bb1b347a4 Download complete 
 f8406d9c00ea Downloading [==================================================>]     116B/116B
 f8406d9c00ea Verifying Checksum 
 f8406d9c00ea Download complete 
 b0a0cf830b12 Extracting [===========================>                       ]  15.93MB/29.15MB
 b0a0cf830b12 Extracting [=========================================>         ]  24.18MB/29.15MB
 c199bff16b05 Downloading [==============>                                    ]     935B/3.145kB
 c199bff16b05 Downloading [==================================================>]  3.145kB/3.145kB
 c199bff16b05 Verifying Checksum 
 c199bff16b05 Download complete 
 c1cb13b19080 Downloading [====>                                              ]     934B/9.925kB
 c1cb13b19080 Downloading [==================================================>]  9.925kB/9.925kB
 c1cb13b19080 Verifying Checksum 
 c1cb13b19080 Download complete 
 b0a0cf830b12 Extracting [==========================================>        ]  24.77MB/29.15MB
 e0d55fdb4d15 Downloading [>                                                  ]    534kB/109MB
 873532e5f8c7 Downloading [==================================================>]     128B/128B
 873532e5f8c7 Verifying Checksum 
 873532e5f8c7 Download complete 
 050d9f8c3b1c Downloading [==================================================>]     169B/169B
 050d9f8c3b1c Verifying Checksum 
 050d9f8c3b1c Download complete 
 e0d55fdb4d15 Downloading [========>                                          ]  17.68MB/109MB
 b0a0cf830b12 Extracting [===============================================>   ]  27.72MB/29.15MB
 e0d55fdb4d15 Downloading [===============>                                   ]  33.76MB/109MB
 710e142705f8 Downloading [========>                                          ]     933B/5.421kB
 710e142705f8 Downloading [==================================================>]  5.421kB/5.421kB
 710e142705f8 Verifying Checksum 
 710e142705f8 Download complete 
 cb628c265f09 Download complete 
 e0d55fdb4d15 Downloading [=======================>                           ]  51.46MB/109MB
 e0d55fdb4d15 Downloading [===============================>                   ]  68.03MB/109MB
 b0a0cf830b12 Extracting [================================================>  ]  28.31MB/29.15MB
 e0d55fdb4d15 Downloading [========================================>          ]  88.87MB/109MB
 b0a0cf830b12 Extracting [==================================================>]  29.15MB/29.15MB
 b0a0cf830b12 Pull complete 
 dda3d8fbd5ed Extracting [==================================================>]  1.165kB/1.165kB
 dda3d8fbd5ed Extracting [==================================================>]  1.165kB/1.165kB
 e0d55fdb4d15 Downloading [=================================================> ]    107MB/109MB
 e0d55fdb4d15 Verifying Checksum 
 e0d55fdb4d15 Download complete 
 dda3d8fbd5ed Pull complete 
 283a477db7bb Extracting [>                                                  ]  65.54kB/4.533MB
 283a477db7bb Extracting [==================================================>]  4.533MB/4.533MB
 283a477db7bb Pull complete 
 91d2729fa4d5 Extracting [=>                                                 ]  32.77kB/1.45MB
 91d2729fa4d5 Extracting [==================================================>]   1.45MB/1.45MB
 91d2729fa4d5 Pull complete 
 9739ced65621 Extracting [>                                                  ]   98.3kB/8.069MB
 9739ced65621 Extracting [========================>                          ]   4.03MB/8.069MB
 9739ced65621 Extracting [======================================>            ]  6.291MB/8.069MB
 9739ced65621 Extracting [==================================================>]  8.069MB/8.069MB
 9739ced65621 Pull complete 
 ae3bb1b347a4 Extracting [=>                                                 ]  32.77kB/1.196MB
 ae3bb1b347a4 Extracting [==================================================>]  1.196MB/1.196MB
 ae3bb1b347a4 Extracting [==================================================>]  1.196MB/1.196MB
 ae3bb1b347a4 Pull complete 
 f8406d9c00ea Extracting [==================================================>]     116B/116B
 f8406d9c00ea Extracting [==================================================>]     116B/116B
 f8406d9c00ea Pull complete 
 c199bff16b05 Extracting [==================================================>]  3.145kB/3.145kB
 c199bff16b05 Extracting [==================================================>]  3.145kB/3.145kB
 c199bff16b05 Pull complete 
 e0d55fdb4d15 Extracting [>                                                  ]  557.1kB/109MB
 e0d55fdb4d15 Extracting [===>                                               ]  7.242MB/109MB
 e0d55fdb4d15 Extracting [====>                                              ]  10.58MB/109MB
 e0d55fdb4d15 Extracting [=======>                                           ]  16.15MB/109MB
 e0d55fdb4d15 Extracting [=========>                                         ]  21.73MB/109MB
 e0d55fdb4d15 Extracting [============>                                      ]   27.3MB/109MB
 e0d55fdb4d15 Extracting [================>                                  ]  36.77MB/109MB
 e0d55fdb4d15 Extracting [=====================>                             ]  46.24MB/109MB
 e0d55fdb4d15 Extracting [========================>                          ]  52.92MB/109MB
 e0d55fdb4d15 Extracting [===========================>                       ]  59.05MB/109MB
 e0d55fdb4d15 Extracting [===============================>                   ]  68.52MB/109MB
 e0d55fdb4d15 Extracting [===================================>               ]  77.99MB/109MB
 e0d55fdb4d15 Extracting [=======================================>           ]   86.9MB/109MB
 e0d55fdb4d15 Extracting [==========================================>        ]  93.03MB/109MB
 e0d55fdb4d15 Extracting [============================================>      ]  96.93MB/109MB
 e0d55fdb4d15 Extracting [==============================================>    ]  100.3MB/109MB
 e0d55fdb4d15 Extracting [===============================================>   ]  103.6MB/109MB
 e0d55fdb4d15 Extracting [================================================>  ]  105.3MB/109MB
 e0d55fdb4d15 Extracting [=================================================> ]  107.5MB/109MB
 e0d55fdb4d15 Extracting [==================================================>]    109MB/109MB
 e0d55fdb4d15 Pull complete 
 c1cb13b19080 Extracting [==================================================>]  9.925kB/9.925kB
 c1cb13b19080 Extracting [==================================================>]  9.925kB/9.925kB
 c1cb13b19080 Pull complete 
 873532e5f8c7 Extracting [==================================================>]     128B/128B
 873532e5f8c7 Extracting [==================================================>]     128B/128B
 873532e5f8c7 Pull complete 
 050d9f8c3b1c Extracting [==================================================>]     169B/169B
 050d9f8c3b1c Extracting [==================================================>]     169B/169B
 050d9f8c3b1c Pull complete 
 710e142705f8 Extracting [==================================================>]  5.421kB/5.421kB
 710e142705f8 Extracting [==================================================>]  5.421kB/5.421kB
 710e142705f8 Pull complete 
 cb628c265f09 Extracting [==================================================>]     184B/184B
 cb628c265f09 Extracting [==================================================>]     184B/184B
 cb628c265f09 Pull complete 
 postgresql Pulled 
 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-postgresql-1  Started
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/passlib/utils/__init__.py,line=854::'crypt' is deprecated and slated for removal in Python 3.13
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0 -- /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo
configfile: setup.cfg
testpaths: tests, invenio_oauth2server
plugins: github-actions-annotate-failures-0.3.0, pycodestyle-2.5.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, isort-4.0.0, cov-7.0.0, pydocstyle-2.4.0
collecting ... collected 152 items

tests/conftest.py::PYDOCSTYLE PASSED
tests/conftest.py::ISORT PASSED
tests/conftest.py::black PASSED
tests/helpers.py::PYDOCSTYLE PASSED
tests/helpers.py::ISORT PASSED
tests/helpers.py::black PASSED
tests/test_admin.py::ISORT PASSED
tests/test_admin.py::black PASSED
tests/test_admin.py::test_admin PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_oauth2server/ext.py,line=332::You are overriding the default OAuthlib "URL encoded" set of valid characters. Make sure that the characters defined in oauthlib.common.urlencoded are indeed limitting your needs.

tests/test_alembic.py::ISORT PASSED
tests/test_alembic.py::black PASSED
tests/test_alembic.py::test_alembic SKIPPED (Caused by mergepoint)
tests/test_cli.py::ISORT PASSED
tests/test_cli.py::black PASSED
tests/test_cli.py::test_cli_tokens PASSED
tests/test_decorators.py::ISORT PASSED
tests/test_decorators.py::black PASSED
tests/test_decorators.py::test_require_api_auth_oauthlib_urldecode_issue PASSED
tests/test_decorators.py::test_require_api_auth_test1 PASSED
tests/test_decorators.py::test_require_api_auth_test2 PASSED
tests/test_decorators.py::test_require_oauth_scopes_test1 PASSED
tests/test_decorators.py::test_require_oauth_scopes_test2 PASSED
tests/test_decorators.py::test_require_oauth_scopes_allow_anonymous PASSED
tests/test_decorators.py::test_rest_extension PASSED
tests/test_decorators.py::test_access_login_required PASSED
tests/test_decorators.py::test_jwt_client PASSED
tests/test_invenio_oauth2server.py::ISORT PASSED
tests/test_invenio_oauth2server.py::black PASSED
tests/test_invenio_oauth2server.py::test_version PASSED
tests/test_invenio_oauth2server.py::test_init PASSED
tests/test_invenio_oauth2server.py::test_init_rest PASSED
tests/test_invenio_oauth2server.py::test_init_rest_with_oauthlib_monkeypatch PASSED
tests/test_models.py::ISORT PASSED
tests/test_models.py::black PASSED
tests/test_models.py::test_empty_redirect_uri_and_scope PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_oauth2server/ext.py,line=332::You are overriding the default OAuthlib "URL encoded" set of valid characters. Make sure that the characters defined in oauthlib.common.urlencoded are indeed limitting your needs.
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_models.py,line=34::Object of type <Client> not in session, add operation along 'User.oauth2clients' will not proceed

tests/test_models.py::test_token_scopes PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/conftest.py,line=271::Object of type <Client> not in session, add operation along 'User.oauth2clients' will not proceed (This warning originated from the Session 'autoflush' process, which was invoked automatically in response to a user-initiated operation. Consider using ``no_autoflush`` context manager if this warning happened while initializing objects.)
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_models.py,line=80::Object of type <Token> not in session, add operation along 'User.oauth2tokens' will not proceed

tests/test_models.py::test_registering_invalid_scope PASSED
tests/test_models.py::test_deletion_of_consumer_resource_owner PASSED
tests/test_models.py::test_deletion_of_resource_owner_consumer PASSED
tests/test_models.py::test_deletion_of_client1 PASSED
tests/test_models.py::test_deletion_of_token1 PASSED
tests/test_models.py::test_deletion_of_token2 PASSED
tests/test_provider.py::ISORT PASSED
tests/test_provider.py::black PASSED
tests/test_provider.py::test_client_salt PASSED
tests/test_provider.py::test_invalid_authorize_requests PASSED
tests/test_provider.py::test_refresh_flow ::error file=package-repo/tests/test_provider.py,line=223::test_refresh_flow%0A%0ATypeError: can't compare offset-naive and offset-aware datetimes
FAILED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id

tests/test_provider.py::test_implicit_flow ::error file=package-repo/tests/test_provider.py,line=385::test_implicit_flow%0A%0ATypeError: can't compare offset-naive and offset-aware datetimes
FAILED
tests/test_provider.py::test_client_flow ::error file=package-repo/tests/test_provider.py,line=433::test_client_flow%0A%0ATypeError: can't compare offset-naive and offset-aware datetimes
FAILED
tests/test_provider.py::test_auth_flow_denied PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_oauthlib/client.py,line=720::The 'warn' method is deprecated, use 'warning' instead

tests/test_provider.py::test_personal_access_token PASSED
tests/test_provider.py::test_resource_auth_methods PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[q=RegularArg-True] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[a=1&b=2&c=3-True] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[q=text+with+spaces-True] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[q=title:TheTitle-True] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[q=properly%20encoded%24-True] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[$type=search-False] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[q=Joan+D'Arc-False] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[with regular spaces-False] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[json_data={a: 42}-False] PASSED
tests/test_provider.py::test_oauthlib_urldecoding_issue[array=[1, 2, 3]-False] PASSED
tests/test_provider.py::test_oauthlib_monkeypatch PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_oauth2server/ext.py,line=332::You are overriding the default OAuthlib "URL encoded" set of valid characters. Make sure that the characters defined in oauthlib.common.urlencoded are indeed limitting your needs.

tests/test_provider.py::test_settings_index PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_oauth2server/ext.py,line=332::You are overriding the default OAuthlib "URL encoded" set of valid characters. Make sure that the characters defined in oauthlib.common.urlencoded are indeed limitting your needs.

tests/test_provider.py::test_info_not_accessible_in_production ::error file=package-repo/tests/test_provider.py,line=739::test_info_not_accessible_in_production%0A%0Aassert 500 == 404%0A +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code
FAILED
tests/test_provider.py::test_expired_refresh_flow ::error file=package-repo/tests/test_provider.py,line=793::test_expired_refresh_flow%0A%0ATypeError: can't compare offset-naive and offset-aware datetimes
FAILED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id

tests/test_provider.py::test_not_allowed_public_refresh_flow ::error file=package-repo/tests/test_provider.py,line=897::test_not_allowed_public_refresh_flow%0A%0ATypeError: can't compare offset-naive and offset-aware datetimes
FAILED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id

tests/test_provider.py::test_password_grant_type PASSED
tests/test_provider.py::test_email_scope PASSED
tests/test_server.py::ISORT PASSED
tests/test_server.py::black PASSED
tests/test_server.py::test_user_identity_init PASSED
tests/test_settings.py::ISORT PASSED
tests/test_settings.py::black PASSED
tests/test_settings.py::test_personal_token_management PASSED
tests/test_settings.py::test_authorized_app_revocation PASSED::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=207::get_user method is deprecated, user get_user_by_email/get_user_by_id
::warning file=/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py,line=219::Object of type <Client> not in session, add operation along 'User.oauth2clients' will not proceed (This warning originated from the Session 'autoflush' process, which was invoked automatically in response to a user-initiated operation. Consider using ``no_autoflush`` context manager if this warning happened while initializing objects.)

tests/test_settings.py::test_client_management PASSED
tests/test_utils.py::ISORT PASSED
tests/test_utils.py::black PASSED
tests/test_utils.py::test_rebuilding_access_tokens PASSED
tests/test_validators.py::ISORT PASSED
tests/test_validators.py::black PASSED
tests/test_validators.py::test_validate_redirect_uri[example.org/-expected0] PASSED
tests/test_validators.py::test_validate_redirect_uri[http://-expected1] PASSED
tests/test_validators.py::test_validate_redirect_uri[http://example.org/-expected2] PASSED
tests/test_validators.py::test_validate_redirect_uri[https://example.org/-None] PASSED
tests/test_validators.py::test_validate_redirect_uri[https://localhost/-None] PASSED
tests/test_validators.py::test_validate_redirect_uri[https://127.0.0.1-None] PASSED
tests/test_validators.py::test_url_validator PASSED
invenio_oauth2server/__init__.py::PYDOCSTYLE PASSED
invenio_oauth2server/__init__.py::ISORT PASSED
invenio_oauth2server/__init__.py::black PASSED
invenio_oauth2server/admin.py::PYDOCSTYLE PASSED
invenio_oauth2server/admin.py::ISORT PASSED
invenio_oauth2server/admin.py::black PASSED
invenio_oauth2server/alembic/12a88921ada2_create_oauth2server_tables.py::PYDOCSTYLE PASSED
invenio_oauth2server/alembic/12a88921ada2_create_oauth2server_tables.py::ISORT PASSED
invenio_oauth2server/alembic/12a88921ada2_create_oauth2server_tables.py::black PASSED
invenio_oauth2server/alembic/4e57407b8e4a_add_on_delete_cascade.py::PYDOCSTYLE PASSED
invenio_oauth2server/alembic/4e57407b8e4a_add_on_delete_cascade.py::ISORT PASSED
invenio_oauth2server/alembic/4e57407b8e4a_add_on_delete_cascade.py::black PASSED
invenio_oauth2server/alembic/aa546f2a8d2f_create_oauth2server_branch.py::PYDOCSTYLE PASSED
invenio_oauth2server/alembic/aa546f2a8d2f_create_oauth2server_branch.py::ISORT PASSED
invenio_oauth2server/alembic/aa546f2a8d2f_create_oauth2server_branch.py::black PASSED
invenio_oauth2server/cli.py::PYDOCSTYLE PASSED
invenio_oauth2server/cli.py::ISORT PASSED
invenio_oauth2server/cli.py::black PASSED
invenio_oauth2server/config.py::PYDOCSTYLE PASSED
invenio_oauth2server/config.py::ISORT PASSED
invenio_oauth2server/config.py::black PASSED
invenio_oauth2server/decorators.py::PYDOCSTYLE PASSED
invenio_oauth2server/decorators.py::ISORT PASSED
invenio_oauth2server/decorators.py::black PASSED
invenio_oauth2server/errors.py::PYDOCSTYLE PASSED
invenio_oauth2server/errors.py::ISORT PASSED
invenio_oauth2server/errors.py::black PASSED
invenio_oauth2server/ext.py::PYDOCSTYLE PASSED
invenio_oauth2server/ext.py::ISORT PASSED
invenio_oauth2server/ext.py::black PASSED
invenio_oauth2server/forms.py::PYDOCSTYLE PASSED
invenio_oauth2server/forms.py::ISORT PASSED
invenio_oauth2server/forms.py::black PASSED
invenio_oauth2server/models.py::PYDOCSTYLE PASSED
invenio_oauth2server/models.py::ISORT PASSED
invenio_oauth2server/models.py::black PASSED
invenio_oauth2server/provider.py::PYDOCSTYLE PASSED
invenio_oauth2server/provider.py::ISORT PASSED
invenio_oauth2server/provider.py::black PASSED
invenio_oauth2server/proxies.py::PYDOCSTYLE PASSED
invenio_oauth2server/proxies.py::ISORT PASSED
invenio_oauth2server/proxies.py::black PASSED
invenio_oauth2server/scopes.py::PYDOCSTYLE PASSED
invenio_oauth2server/scopes.py::ISORT PASSED
invenio_oauth2server/scopes.py::black PASSED
invenio_oauth2server/theme/semantic/form_styling.py::PYDOCSTYLE PASSED
invenio_oauth2server/theme/semantic/form_styling.py::ISORT PASSED
invenio_oauth2server/theme/semantic/form_styling.py::black PASSED
invenio_oauth2server/utils.py::PYDOCSTYLE PASSED
invenio_oauth2server/utils.py::ISORT PASSED
invenio_oauth2server/utils.py::black PASSED
invenio_oauth2server/validators.py::PYDOCSTYLE PASSED
invenio_oauth2server/validators.py::ISORT PASSED
invenio_oauth2server/validators.py::black PASSED
invenio_oauth2server/views/__init__.py::PYDOCSTYLE PASSED
invenio_oauth2server/views/__init__.py::ISORT PASSED
invenio_oauth2server/views/__init__.py::black PASSED
invenio_oauth2server/views/server.py::PYDOCSTYLE PASSED
invenio_oauth2server/views/server.py::ISORT PASSED
invenio_oauth2server/views/server.py::black PASSED
invenio_oauth2server/views/settings.py::PYDOCSTYLE PASSED
invenio_oauth2server/views/settings.py::ISORT PASSED
invenio_oauth2server/views/settings.py::black PASSED

=================================== FAILURES ===================================
______________________________ test_refresh_flow _______________________________

provider_fixture = <Flask 'testapp'>

    def test_refresh_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            base_url = "https://{0}".format(app.config["SERVER_NAME"])
            redirect_uri = url_for("oauth2test.authorized", _external=True)
    
            with app.test_client() as client:
                # First login on provider site
                login(client)
    
                data = dict(
                    redirect_uri=redirect_uri,
                    scope="test:scope",
                    response_type="code",
                    client_id="confidential",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="confidential",
                        client_secret="confidential",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                json_resp = json.loads(r.get_data())
                assert json_resp["access_token"]
                assert json_resp["refresh_token"]
                assert json_resp["scope"] == "test:scope"
                assert json_resp["token_type"] == "Bearer"
                assert json_resp["user"]["id"]
                refresh_token = json_resp["refresh_token"]
                old_access_token = json_resp["access_token"]
    
                # Access token valid
>               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = <Flask 'testapp'>
base_url   = 'https://None'
client     = <FlaskClient <Flask 'testapp'>>
data       = {'client_id': 'confidential',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
json_resp  = {'access_token': 'xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'expires_in': 3600,
 'refresh_token': 'aXgLDIg9oPu3wA4sV7FrKfqgGaygqo',
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'xhgArr7DshUsDlO0SLE0ImUKXjXlLk'
provider_fixture = <Flask 'testapp'>
r          = <WrapperTestResponse 189 bytes [200 OK]>
redirect_uri = 'http://localhost/oauth2test/authorized'
refresh_token = 'aXgLDIg9oPu3wA4sV7FrKfqgGaygqo'
res_data   = {'code': ['QZL8bal3IDTJZFNFKi4dQ2uQgp6I5a'], 'state': ['mystate']}

tests/test_provider.py:223: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',)
        kw         = {'method': 'GET'}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = <class 'flask.testing.FlaskClient'>
        args       = ('/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>},
 'method': 'GET'}
        request    = <Request 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = <Request 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET]>
        args       = (<Request 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET]>,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = <Request 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'RAW_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>,
 'werkzeug.request': <Request 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET]>,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaffb5ad0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <Flask 'testapp'>
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'RAW_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaffb5ad0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeaff09300>
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'RAW_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaffb5ad0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeaff09300>
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <bound method Flask.wsgi_app of <Flask 'testapp'>>
        environ    = {'HTTP_COOKIE': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'RAW_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaffb5ad0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = <werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7feeb02555b0>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeaff09300>
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'RAW_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaffb5ad0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeaff09300>
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'RAW_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb3d24400>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaffb5ad0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeaff09300>
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = <Request 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk' [GET]>
        rule       = <Rule '/oauth/info' (HEAD, GET, OPTIONS) -> invenio_oauth2server.info>
        self       = <Flask 'testapp'>
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = <function info at 0x7feeb6344360>
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
        uri        = 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        f          = <function ResourceEndpoint.verify_request at 0x7feeba2fe160>
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=a1c2bf06142c165e_691c5aad.PJsJYG-dB0vbbJPwR2GG0fB8eaU',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = <oauthlib.Request SANITIZED>
        scopes     = ('test:scope',)
        self       = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        token_type_handler = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        uri        = 'http://localhost/oauth/info?access_token=xhgArr7DshUsDlO0SLE0ImUKXjXlLk'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = <oauthlib.Request SANITIZED>
        self       = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        token      = 'xhgArr7DshUsDlO0SLE0ImUKXjXlLk'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
token = 'xhgArr7DshUsDlO0SLE0ImUKXjXlLk', scopes = ('test:scope',)
request = <oauthlib.Request SANITIZED>

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
>               datetime.datetime.now(datetime.timezone.utc) > tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = <oauthlib.Request SANITIZED>
scopes     = ('test:scope',)
self       = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
tok        = <Token 3>
token      = 'xhgArr7DshUsDlO0SLE0ImUKXjXlLk'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError
______________________________ test_implicit_flow ______________________________

provider_fixture = <Flask 'testapp'>

    def test_implicit_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            redirect_uri = url_for("oauth2test.authorized", _external=True)
    
            with app.test_client() as client:
                # First login on provider site
                login(client)
    
                for client_id in ["dev", "confidential"]:
                    data = dict(
                        redirect_uri=redirect_uri,
                        response_type="token",  # For implicit grant type
                        client_id=client_id,
                        scope="test:scope",
                        state="teststate",
                    )
    
                    # Authorize page
                    r = client.get(
                        url_for("invenio_oauth2server.authorize", **data),
                        follow_redirects=True,
                    )
                    assert r.status_code == 200
    
                    # User confirms request
                    data["confirm"] = "yes"
                    data["scope"] = "test:scope"
                    data["state"] = "teststate"
    
                    r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                    assert r.status_code == 302
                    # Important - access token exists in URI fragment and must not
                    # be sent to the client.
                    next_url, data = parse_redirect(r.location, parse_fragment=True)
    
                    assert data["access_token"]
                    assert data["token_type"] == ["Bearer"]
                    assert data["state"] == ["teststate"]
                    assert data["scope"] == ["test:scope"]
                    assert data.get("refresh_token") is None
                    assert next_url == redirect_uri
    
                    # Authentication flow has now been completed, and the client
                    # can use the access token to make request to the provider.
>                   r = client.get(
                        url_for(
                            "invenio_oauth2server.info", access_token=data["access_token"]
                        )
                    )

app        = <Flask 'testapp'>
client     = <FlaskClient <Flask 'testapp'>>
client_id  = 'dev'
data       = {'access_token': ['f540rJci8rh0yaVEBS4i8dpxc5Rp4e'],
 'expires_in': ['3600'],
 'scope': ['test:scope'],
 'state': ['teststate'],
 'token_type': ['Bearer'],
 'user': ["{'id': '1'}"]}
next_url   = 'http://localhost/oauth2test/authorized'
provider_fixture = <Flask 'testapp'>
r          = <WrapperTestResponse streamed [302 FOUND]>
redirect_uri = 'http://localhost/oauth2test/authorized'

tests/test_provider.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',)
        kw         = {'method': 'GET'}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = <class 'flask.testing.FlaskClient'>
        args       = ('/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>},
 'method': 'GET'}
        request    = <Request 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = <Request 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET]>
        args       = (<Request 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET]>,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = <Request 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'RAW_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>,
 'werkzeug.request': <Request 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET]>,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb3e46980>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <Flask 'testapp'>
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'RAW_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb3e46980>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb43263e0>
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'RAW_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb3e46980>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb43263e0>
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <bound method Flask.wsgi_app of <Flask 'testapp'>>
        environ    = {'HTTP_COOKIE': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'RAW_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb3e46980>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = <werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7feeb9a4e000>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb43263e0>
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'RAW_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb3e46980>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb43263e0>
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'RAW_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4498840>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb3e46980>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb43263e0>
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = <Request 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e' [GET]>
        rule       = <Rule '/oauth/info' (HEAD, GET, OPTIONS) -> invenio_oauth2server.info>
        self       = <Flask 'testapp'>
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = <function info at 0x7feeb6344360>
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
        uri        = 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        f          = <function ResourceEndpoint.verify_request at 0x7feeba2fe160>
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=681b69de21d82e23_691c5aae.iDopa36agi74kByw9hx_PtaYrek',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = <oauthlib.Request SANITIZED>
        scopes     = ('test:scope',)
        self       = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        token_type_handler = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        uri        = 'http://localhost/oauth/info?access_token=f540rJci8rh0yaVEBS4i8dpxc5Rp4e'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = <oauthlib.Request SANITIZED>
        self       = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        token      = 'f540rJci8rh0yaVEBS4i8dpxc5Rp4e'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
token = 'f540rJci8rh0yaVEBS4i8dpxc5Rp4e', scopes = ('test:scope',)
request = <oauthlib.Request SANITIZED>

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
>               datetime.datetime.now(datetime.timezone.utc) > tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = <oauthlib.Request SANITIZED>
scopes     = ('test:scope',)
self       = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
tok        = <Token 3>
token      = 'f540rJci8rh0yaVEBS4i8dpxc5Rp4e'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError
_______________________________ test_client_flow _______________________________

provider_fixture = <Flask 'testapp'>

    def test_client_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            with app.test_client() as client:
                data = dict(
                    client_id="dev",
                    client_secret="dev",  # A public client should NOT do this!
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Public clients are not allowed to use
                # grant_type=client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 401
                assert json.loads(r.get_data()).get("error") == "invalid_client"
    
                data = dict(
                    client_id="confidential",
                    client_secret="confidential",
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Retrieve access token using client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 200
    
                data = json.loads(r.get_data())
                assert data["access_token"]
                assert data["token_type"] == "Bearer"
                assert data["scope"] == "test:scope"
                assert data["user"]["id"]
                assert data.get("refresh_token") is None
    
                # Authentication flow has now been completed, and the client can
                # use the access token to make request to the provider.
>               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=data["access_token"])
                )

app        = <Flask 'testapp'>
client     = <FlaskClient <Flask 'testapp'>>
data       = {'access_token': '2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'expires_in': 3600,
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
provider_fixture = <Flask 'testapp'>
r          = <WrapperTestResponse 138 bytes [200 OK]>

tests/test_provider.py:433: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',)
        kw         = {'method': 'GET'}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = <class 'flask.testing.FlaskClient'>
        args       = ('/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>},
 'method': 'GET'}
        request    = <Request 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = <Request 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET]>
        args       = (<Request 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET]>,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = <Request 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'RAW_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>,
 'werkzeug.request': <Request 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET]>,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb509a750>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <Flask 'testapp'>
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'RAW_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb509a750>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb3dcc680>
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'RAW_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb509a750>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb3dcc680>
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <bound method Flask.wsgi_app of <Flask 'testapp'>>
        environ    = {'HTTP_COOKIE': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'RAW_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb509a750>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = <werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7feeb4303e60>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb3dcc680>
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'RAW_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb509a750>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb3dcc680>
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'RAW_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb9aee800>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb509a750>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb3dcc680>
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = <Request 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM' [GET]>
        rule       = <Rule '/oauth/info' (HEAD, GET, OPTIONS) -> invenio_oauth2server.info>
        self       = <Flask 'testapp'>
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = <function info at 0x7feeb6344360>
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
        uri        = 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        f          = <function ResourceEndpoint.verify_request at 0x7feeba2fe160>
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=c35030ffaea2dca4_691c5aaf.nQDELHNKuPfbsJlHpglmL4nz9ME',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = <oauthlib.Request SANITIZED>
        scopes     = ('test:scope',)
        self       = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        token_type_handler = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        uri        = 'http://localhost/oauth/info?access_token=2zrgMELbNHcUnK3FLizxjORlZE0viM'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = <oauthlib.Request SANITIZED>
        self       = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        token      = '2zrgMELbNHcUnK3FLizxjORlZE0viM'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
token = '2zrgMELbNHcUnK3FLizxjORlZE0viM', scopes = ('test:scope',)
request = <oauthlib.Request SANITIZED>

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
>               datetime.datetime.now(datetime.timezone.utc) > tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = <oauthlib.Request SANITIZED>
scopes     = ('test:scope',)
self       = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
tok        = <Token 3>
token      = '2zrgMELbNHcUnK3FLizxjORlZE0viM'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError
____________________ test_info_not_accessible_in_production ____________________

provider_fixture = <Flask 'testapp'>

    def test_info_not_accessible_in_production(provider_fixture):
        """Info route should not be available in production mode."""
        app = provider_fixture
        with app.test_request_context():
            with app.test_client() as client:
                app.config.update(
                    DEBUG=False,
                    TESTING=False,
                )
                data = dict(
                    client_id="dev",
                    client_secret="dev",  # A public client should NOT do this!
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Public clients are not allowed to use
                # grant_type=client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 401
                assert json.loads(r.get_data()).get("error") == "invalid_client"
    
                data = dict(
                    client_id="confidential",
                    client_secret="confidential",
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Retrieve access token using client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 200
    
                data = json.loads(r.get_data())
                assert data["access_token"]
                assert data["token_type"] == "Bearer"
                assert data["scope"] == "test:scope"
                assert data.get("refresh_token") is None
                assert data["user"]["id"]
    
                # Authentication flow has now been completed, and the client can
                # use the access token to make request to the provider.
                r = client.get(
                    url_for("invenio_oauth2server.info", access_token=data["access_token"])
                )
>               assert r.status_code == 404
E               assert 500 == 404
E                +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

app        = <Flask 'testapp'>
client     = <FlaskClient <Flask 'testapp'>>
data       = {'access_token': 'oTFeLmcwwsrZK3MKeQXqXGdCEt1rkA',
 'expires_in': 3600,
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
provider_fixture = <Flask 'testapp'>
r          = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>

tests/test_provider.py:739: AssertionError
------------------------------ Captured log call -------------------------------
ERROR    testapp:app.py:875 Exception on /oauth/info [GET]
Traceback (most recent call last):
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py", line 607, in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py", line 534, in verify_request
    return self.server.verify_request(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py", line 112, in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py", line 72, in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py", line 337, in validate_request
    return self.request_validator.validate_bearer_token(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py", line 864, in validate_bearer_token
    datetime.datetime.now(datetime.timezone.utc) > tok.expires:
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: can't compare offset-naive and offset-aware datetimes
__________________________ test_expired_refresh_flow ___________________________

provider_fixture = <Flask 'testapp'>

    def test_expired_refresh_flow(provider_fixture):
        """Test refresh flow with an expired token."""
        app = provider_fixture
        # First login on provider site
        with app.test_request_context():
            with app.test_client() as client:
                login(client)
    
                data = dict(
                    redirect_uri=url_for("oauth2test.authorized", _external=True),
                    scope="test:scope",
                    response_type="code",
                    client_id="confidential",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                assert r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="confidential",
                        client_secret="confidential",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                assert json.loads(r.get_data())["access_token"]
                assert json.loads(r.get_data())["refresh_token"]
                assert json.loads(r.get_data())["expires_in"] > 0
                assert json.loads(r.get_data())["scope"] == "test:scope"
                assert json.loads(r.get_data())["token_type"] == "Bearer"
                assert json.loads(r.get_data())["user"]["id"]
                refresh_token = json.loads(r.get_data())["refresh_token"]
                old_access_token = json.loads(r.get_data())["access_token"]
    
                # Access token valid
>               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = <Flask 'testapp'>
client     = <FlaskClient <Flask 'testapp'>>
data       = {'client_id': 'confidential',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'ad8hHHk56jSjUfXCfGUnUb5ZymJgRc'
provider_fixture = <Flask 'testapp'>
r          = <WrapperTestResponse 189 bytes [200 OK]>
refresh_token = 'DIFSLODRhJ85C3trirmjkaJDkEFdtx'
res_data   = {'code': ['7WtjKlcFa73sRcKBz6zGZBN4We8L1H'], 'state': ['mystate']}

tests/test_provider.py:793: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',)
        kw         = {'method': 'GET'}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = <class 'flask.testing.FlaskClient'>
        args       = ('/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>},
 'method': 'GET'}
        request    = <Request 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = <Request 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET]>
        args       = (<Request 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET]>,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = <Request 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'RAW_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>,
 'werkzeug.request': <Request 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET]>,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaf98b1a0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <Flask 'testapp'>
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'RAW_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaf98b1a0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb42c6020>
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'RAW_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaf98b1a0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb42c6020>
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <bound method Flask.wsgi_app of <Flask 'testapp'>>
        environ    = {'HTTP_COOKIE': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'RAW_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaf98b1a0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = <werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7feeb009bc80>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb42c6020>
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'RAW_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaf98b1a0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb42c6020>
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'RAW_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb44daf00>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeaf98b1a0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb42c6020>
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = <Request 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc' [GET]>
        rule       = <Rule '/oauth/info' (HEAD, GET, OPTIONS) -> invenio_oauth2server.info>
        self       = <Flask 'testapp'>
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = <function info at 0x7feeb6344360>
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
        uri        = 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        f          = <function ResourceEndpoint.verify_request at 0x7feeba2fe160>
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=bb7c8e3f371999ef_691c5ab8.GebuEwOKzxLWy5CsI-y9MZu8p3c',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = <oauthlib.Request SANITIZED>
        scopes     = ('test:scope',)
        self       = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        token_type_handler = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        uri        = 'http://localhost/oauth/info?access_token=ad8hHHk56jSjUfXCfGUnUb5ZymJgRc'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = <oauthlib.Request SANITIZED>
        self       = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        token      = 'ad8hHHk56jSjUfXCfGUnUb5ZymJgRc'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
token = 'ad8hHHk56jSjUfXCfGUnUb5ZymJgRc', scopes = ('test:scope',)
request = <oauthlib.Request SANITIZED>

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
>               datetime.datetime.now(datetime.timezone.utc) > tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = <oauthlib.Request SANITIZED>
scopes     = ('test:scope',)
self       = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
tok        = <Token 3>
token      = 'ad8hHHk56jSjUfXCfGUnUb5ZymJgRc'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError
_____________________ test_not_allowed_public_refresh_flow _____________________

provider_fixture = <Flask 'testapp'>

    def test_not_allowed_public_refresh_flow(provider_fixture):
        """Public token should not allow refreshing."""
        app = provider_fixture
        # First login on provider site
        with app.test_request_context():
            with app.test_client() as client:
                login(client)
    
                data = dict(
                    redirect_uri=url_for("oauth2test.authorized", _external=True),
                    scope="test:scope",
                    response_type="code",
                    client_id="dev",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                assert r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="dev",
                        client_secret="dev",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                json_resp = json.loads(r.get_data())
                assert json_resp["access_token"]
                assert json_resp["refresh_token"]
                assert json_resp["expires_in"] > 0
                assert json_resp["scope"] == "test:scope"
                assert json_resp["token_type"] == "Bearer"
                assert json_resp["user"]["id"]
                refresh_token = json_resp["refresh_token"]
                old_access_token = json_resp["access_token"]
    
                # Access token valid
>               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = <Flask 'testapp'>
client     = <FlaskClient <Flask 'testapp'>>
data       = {'client_id': 'dev',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
json_resp  = {'access_token': 'eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'expires_in': 3600,
 'refresh_token': 'OA5waTn0O733gttRBnrWApW7PGHosi',
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'eYXOF7zJjdiYx0x2Fawrpb3nMeghLM'
provider_fixture = <Flask 'testapp'>
r          = <WrapperTestResponse 189 bytes [200 OK]>
refresh_token = 'OA5waTn0O733gttRBnrWApW7PGHosi'
res_data   = {'code': ['B7AWHalZYhXTGignemjsFaNtzGR2Tb'], 'state': ['mystate']}

tests/test_provider.py:897: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',)
        kw         = {'method': 'GET'}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = <class 'flask.testing.FlaskClient'>
        args       = ('/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>},
 'method': 'GET'}
        request    = <Request 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = <Request 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET]>
        args       = (<Request 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET]>,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = <Request 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET]>
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'RAW_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>,
 'werkzeug.request': <Request 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET]>,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb511f3d0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <FlaskClient <Flask 'testapp'>>
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <Flask 'testapp'>
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'RAW_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb511f3d0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb4d1f6a0>
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'RAW_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb511f3d0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb4d1f6a0>
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = <bound method Flask.wsgi_app of <Flask 'testapp'>>
        environ    = {'HTTP_COOKIE': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'RAW_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb511f3d0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = <werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7feeaf96b680>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb4d1f6a0>
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'RAW_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb511f3d0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb4d1f6a0>
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = <RequestContext 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET] of testapp>
        environ    = {'HTTP_COOKIE': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'RAW_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': <built-in method append of list object at 0x7feeb4244280>,
 'werkzeug.request': None,
 'wsgi.errors': <_io.TextIOWrapper name='<stderr>' mode='w' encoding='utf-8'>,
 'wsgi.input': <_io.BytesIO object at 0x7feeb511f3d0>,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = <Flask 'testapp'>
        start_response = <function run_wsgi_app.<locals>.start_response at 0x7feeb4d1f6a0>
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = <Flask 'testapp'>
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = <Request 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM' [GET]>
        rule       = <Rule '/oauth/info' (HEAD, GET, OPTIONS) -> invenio_oauth2server.info>
        self       = <Flask 'testapp'>
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = <function info at 0x7feeb6344360>
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = <flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7feeb670b680>
        uri        = 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        f          = <function ResourceEndpoint.verify_request at 0x7feeba2fe160>
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=2de4af11325baab_691c5ab9.DtzcYHx5PyZCv7z24PcqFXxDsSM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = <oauthlib.Request SANITIZED>
        scopes     = ('test:scope',)
        self       = <oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7feeb455eae0>
        token_type_handler = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        uri        = 'http://localhost/oauth/info?access_token=eYXOF7zJjdiYx0x2Fawrpb3nMeghLM'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = <oauthlib.Request SANITIZED>
        self       = <oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7feeb4425440>
        token      = 'eYXOF7zJjdiYx0x2Fawrpb3nMeghLM'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
token = 'eYXOF7zJjdiYx0x2Fawrpb3nMeghLM', scopes = ('test:scope',)
request = <oauthlib.Request SANITIZED>

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
>               datetime.datetime.now(datetime.timezone.utc) > tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = <oauthlib.Request SANITIZED>
scopes     = ('test:scope',)
self       = <flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7feeb455e540>
tok        = <Token 3>
token      = 'eYXOF7zJjdiYx0x2Fawrpb3nMeghLM'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError
=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

tests/test_admin.py::test_admin
tests/test_models.py::test_empty_redirect_uri_and_scope
tests/test_provider.py::test_oauthlib_monkeypatch
tests/test_provider.py::test_settings_index
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_oauth2server/ext.py:332: RuntimeWarning: You are overriding the default OAuthlib "URL encoded" set of valid characters. Make sure that the characters defined in oauthlib.common.urlencoded are indeed limitting your needs.
    warnings.warn(

tests/test_models.py::test_empty_redirect_uri_and_scope
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_models.py:34: SAWarning: Object of type <Client> not in session, add operation along 'User.oauth2clients' will not proceed
    with db.session.begin_nested():

tests/test_models.py::test_token_scopes
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/conftest.py:271: SAWarning: Object of type <Client> not in session, add operation along 'User.oauth2clients' will not proceed (This warning originated from the Session 'autoflush' process, which was invoked automatically in response to a user-initiated operation. Consider using ``no_autoflush`` context manager if this warning happened while initializing objects.)
    app.test_user = lambda: db.session.get(User, test_user_id)

tests/test_models.py::test_token_scopes
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_models.py:80: SAWarning: Object of type <Token> not in session, add operation along 'User.oauth2tokens' will not proceed
    with db.session.begin_nested():

tests/test_provider.py: 9 warnings
tests/test_settings.py: 1 warning
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py:207: DeprecationWarning: get_user method is deprecated, user get_user_by_email/get_user_by_id
    warnings.warn(

tests/test_provider.py::test_auth_flow_denied
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_oauthlib/client.py:720: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    log.warn(

tests/test_settings.py::test_authorized_app_revocation
  /home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/flask_security/datastore.py:219: SAWarning: Object of type <Client> not in session, add operation along 'User.oauth2clients' will not proceed (This warning originated from the Session 'autoflush' process, which was invoked automatically in response to a user-initiated operation. Consider using ``no_autoflush`` context manager if this warning happened while initializing objects.)
    rv = self.user_model.query.filter(query).first()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
- generated xml file: /home/runner/work/invenio-bug-verification/invenio-bug-verification/artifacts/test-report-patched.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                                                                      Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------------------------------------
invenio_oauth2server/__init__.py                                              5      0   100%
invenio_oauth2server/admin.py                                                23      0   100%
invenio_oauth2server/alembic/4e57407b8e4a_add_on_delete_cascade.py           25     18    28%   22-73, 83-121
invenio_oauth2server/alembic/12a88921ada2_create_oauth2server_tables.py      19     10    47%   25-82, 93-101
invenio_oauth2server/alembic/aa546f2a8d2f_create_oauth2server_branch.py       8      2    75%   21, 26
invenio_oauth2server/cli.py                                                  56      6    89%   39, 81, 93-97
invenio_oauth2server/config.py                                               22      0   100%
invenio_oauth2server/decorators.py                                           33      0   100%
invenio_oauth2server/errors.py                                               38      2    95%   41, 59
invenio_oauth2server/ext.py                                                 132     10    92%   48-50, 106-107, 192, 194, 233, 236, 343-345
invenio_oauth2server/forms.py                                                58      1    98%   51
invenio_oauth2server/models.py                                              170      5    97%   75, 80, 206-208
invenio_oauth2server/provider.py                                             58      4    93%   60, 123, 153-155
invenio_oauth2server/proxies.py                                               4      0   100%
invenio_oauth2server/scopes.py                                                4      0   100%
invenio_oauth2server/theme/semantic/form_styling.py                          20     14    30%   19, 23-40, 45
invenio_oauth2server/utils.py                                                30      1    97%   68
invenio_oauth2server/validators.py                                           26      0   100%
invenio_oauth2server/views/__init__.py                                        3      0   100%
invenio_oauth2server/views/server.py                                         69     12    83%   46-53, 71, 97, 137-146, 153-157
invenio_oauth2server/views/settings.py                                      117      6    95%   42, 70, 203, 233, 268-269
-------------------------------------------------------------------------------------------------------
TOTAL                                                                       920     91    90%
=========================== short test summary info ============================
FAILED tests/test_provider.py::test_refresh_flow - TypeError: can't compare offset-naive and offset-aware datetimes
FAILED tests/test_provider.py::test_implicit_flow - TypeError: can't compare offset-naive and offset-aware datetimes
FAILED tests/test_provider.py::test_client_flow - TypeError: can't compare offset-naive and offset-aware datetimes
FAILED tests/test_provider.py::test_info_not_accessible_in_production - assert 500 == 404
 +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code
FAILED tests/test_provider.py::test_expired_refresh_flow - TypeError: can't compare offset-naive and offset-aware datetimes
FAILED tests/test_provider.py::test_not_allowed_public_refresh_flow - TypeError: can't compare offset-naive and offset-aware datetimes
============ 6 failed, 145 passed, 1 skipped, 20 warnings in 39.72s ============
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-postgresql-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
