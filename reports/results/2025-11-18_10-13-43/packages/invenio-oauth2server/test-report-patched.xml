<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="6" skipped="1" tests="152" time="38.126" timestamp="2025-11-18T09:24:00.935513+00:00" hostname="runnervmg1sw1"><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.039" /><testcase classname="tests.conftest" name="ISORT" time="0.213" /><testcase classname="tests.conftest" name="black" time="0.416" /><testcase classname="tests.helpers" name="PYDOCSTYLE" time="0.012" /><testcase classname="tests.helpers" name="ISORT" time="0.025" /><testcase classname="tests.helpers" name="black" time="0.182" /><testcase classname="tests.test_admin" name="ISORT" time="0.019" /><testcase classname="tests.test_admin" name="black" time="0.175" /><testcase classname="tests.test_admin" name="test_admin" time="0.986" /><testcase classname="tests.test_alembic" name="ISORT" time="0.011" /><testcase classname="tests.test_alembic" name="black" time="0.161" /><testcase classname="tests.test_alembic" name="test_alembic" time="0.000"><skipped type="pytest.skip" message="Caused by mergepoint">/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/tests/test_alembic.py:16: Caused by mergepoint</skipped></testcase><testcase classname="tests.test_cli" name="ISORT" time="0.014" /><testcase classname="tests.test_cli" name="black" time="0.163" /><testcase classname="tests.test_cli" name="test_cli_tokens" time="0.535" /><testcase classname="tests.test_decorators" name="ISORT" time="0.037" /><testcase classname="tests.test_decorators" name="black" time="0.205" /><testcase classname="tests.test_decorators" name="test_require_api_auth_oauthlib_urldecode_issue" time="0.539" /><testcase classname="tests.test_decorators" name="test_require_api_auth_test1" time="0.503" /><testcase classname="tests.test_decorators" name="test_require_api_auth_test2" time="0.508" /><testcase classname="tests.test_decorators" name="test_require_oauth_scopes_test1" time="0.506" /><testcase classname="tests.test_decorators" name="test_require_oauth_scopes_test2" time="0.510" /><testcase classname="tests.test_decorators" name="test_require_oauth_scopes_allow_anonymous" time="0.514" /><testcase classname="tests.test_decorators" name="test_rest_extension" time="0.505" /><testcase classname="tests.test_decorators" name="test_access_login_required" time="0.556" /><testcase classname="tests.test_decorators" name="test_jwt_client" time="0.656" /><testcase classname="tests.test_invenio_oauth2server" name="ISORT" time="0.021" /><testcase classname="tests.test_invenio_oauth2server" name="black" time="0.167" /><testcase classname="tests.test_invenio_oauth2server" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_oauth2server" name="test_init" time="0.330" /><testcase classname="tests.test_invenio_oauth2server" name="test_init_rest" time="0.004" /><testcase classname="tests.test_invenio_oauth2server" name="test_init_rest_with_oauthlib_monkeypatch" time="0.002" /><testcase classname="tests.test_models" name="ISORT" time="0.053" /><testcase classname="tests.test_models" name="black" time="0.216" /><testcase classname="tests.test_models" name="test_empty_redirect_uri_and_scope" time="0.507" /><testcase classname="tests.test_models" name="test_token_scopes" time="0.510" /><testcase classname="tests.test_models" name="test_registering_invalid_scope" time="0.488" /><testcase classname="tests.test_models" name="test_deletion_of_consumer_resource_owner" time="0.528" /><testcase classname="tests.test_models" name="test_deletion_of_resource_owner_consumer" time="0.520" /><testcase classname="tests.test_models" name="test_deletion_of_client1" time="0.521" /><testcase classname="tests.test_models" name="test_deletion_of_token1" time="0.510" /><testcase classname="tests.test_models" name="test_deletion_of_token2" time="0.505" /><testcase classname="tests.test_provider" name="ISORT" time="0.153" /><testcase classname="tests.test_provider" name="black" time="0.363" /><testcase classname="tests.test_provider" name="test_client_salt" time="0.520" /><testcase classname="tests.test_provider" name="test_invalid_authorize_requests" time="0.736" /><testcase classname="tests.test_provider" name="test_refresh_flow" time="0.609"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_refresh_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            base_url = "https://{0}".format(app.config["SERVER_NAME"])
            redirect_uri = url_for("oauth2test.authorized", _external=True)
    
            with app.test_client() as client:
                # First login on provider site
                login(client)
    
                data = dict(
                    redirect_uri=redirect_uri,
                    scope="test:scope",
                    response_type="code",
                    client_id="confidential",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="confidential",
                        client_secret="confidential",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                json_resp = json.loads(r.get_data())
                assert json_resp["access_token"]
                assert json_resp["refresh_token"]
                assert json_resp["scope"] == "test:scope"
                assert json_resp["token_type"] == "Bearer"
                assert json_resp["user"]["id"]
                refresh_token = json_resp["refresh_token"]
                old_access_token = json_resp["access_token"]
    
                # Access token valid
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = &lt;Flask 'testapp'&gt;
base_url   = 'https://None'
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'client_id': 'confidential',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
json_resp  = {'access_token': 'DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'expires_in': 3600,
 'refresh_token': 'wSVHmwr0BxZRQnMxVDxkqJr5suEox0',
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 189 bytes [200 OK]&gt;
redirect_uri = 'http://localhost/oauth2test/authorized'
refresh_token = 'wSVHmwr0BxZRQnMxVDxkqJr5suEox0'
res_data   = {'code': ['3TNca6EW2yYm64m9103Jgek1fsNcQK'], 'state': ['mystate']}

tests/test_provider.py:223: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'RAW_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a1ec270&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'RAW_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a1ec270&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5865d2d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'RAW_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a1ec270&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5865d2d300&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'RAW_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a1ec270&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7f58660a6db0&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5865d2d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'RAW_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a1ec270&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5865d2d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'RAW_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5866158700&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a1ec270&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5865d2d300&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (GET, OPTIONS, HEAD) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7f586bf24360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
        uri        = 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7f586ffb2160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=ac965a118247bc5_691c3b41.7YuSxMk2GS2WyIZbsWFvKCrh4Qs',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        uri        = 'http://localhost/oauth/info?access_token=DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        token      = 'DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
token = 'DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
tok        = &lt;Token 3&gt;
token      = 'DmLj2vFAaNn5bXo7KZUOPAyUHdPZm8'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_implicit_flow" time="0.596"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_implicit_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            redirect_uri = url_for("oauth2test.authorized", _external=True)
    
            with app.test_client() as client:
                # First login on provider site
                login(client)
    
                for client_id in ["dev", "confidential"]:
                    data = dict(
                        redirect_uri=redirect_uri,
                        response_type="token",  # For implicit grant type
                        client_id=client_id,
                        scope="test:scope",
                        state="teststate",
                    )
    
                    # Authorize page
                    r = client.get(
                        url_for("invenio_oauth2server.authorize", **data),
                        follow_redirects=True,
                    )
                    assert r.status_code == 200
    
                    # User confirms request
                    data["confirm"] = "yes"
                    data["scope"] = "test:scope"
                    data["state"] = "teststate"
    
                    r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                    assert r.status_code == 302
                    # Important - access token exists in URI fragment and must not
                    # be sent to the client.
                    next_url, data = parse_redirect(r.location, parse_fragment=True)
    
                    assert data["access_token"]
                    assert data["token_type"] == ["Bearer"]
                    assert data["state"] == ["teststate"]
                    assert data["scope"] == ["test:scope"]
                    assert data.get("refresh_token") is None
                    assert next_url == redirect_uri
    
                    # Authentication flow has now been completed, and the client
                    # can use the access token to make request to the provider.
&gt;                   r = client.get(
                        url_for(
                            "invenio_oauth2server.info", access_token=data["access_token"]
                        )
                    )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
client_id  = 'dev'
data       = {'access_token': ['w4Fk59rDJQEUJwC5vJ88IXkGteZSWO'],
 'expires_in': ['3600'],
 'scope': ['test:scope'],
 'state': ['teststate'],
 'token_type': ['Bearer'],
 'user': ["{'id': '1'}"]}
next_url   = 'http://localhost/oauth2test/authorized'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse streamed [302 FOUND]&gt;
redirect_uri = 'http://localhost/oauth2test/authorized'

tests/test_provider.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'RAW_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f5869a35bc0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'RAW_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f5869a35bc0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869f07880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'RAW_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f5869a35bc0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869f07880&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'RAW_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f5869a35bc0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7f586f607b00&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869f07880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'RAW_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f5869a35bc0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869f07880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'RAW_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f58699fef40&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f5869a35bc0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869f07880&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (GET, OPTIONS, HEAD) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7f586bf24360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
        uri        = 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7f586ffb2160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=8a9da1b00f517805_691c3b42.B66Wa_ohS_eQb4KVrSrQzFZDlak',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        uri        = 'http://localhost/oauth/info?access_token=w4Fk59rDJQEUJwC5vJ88IXkGteZSWO'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        token      = 'w4Fk59rDJQEUJwC5vJ88IXkGteZSWO'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
token = 'w4Fk59rDJQEUJwC5vJ88IXkGteZSWO', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
tok        = &lt;Token 3&gt;
token      = 'w4Fk59rDJQEUJwC5vJ88IXkGteZSWO'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_client_flow" time="0.528"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_client_flow(provider_fixture):
        app = provider_fixture
        with app.test_request_context():
            with app.test_client() as client:
                data = dict(
                    client_id="dev",
                    client_secret="dev",  # A public client should NOT do this!
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Public clients are not allowed to use
                # grant_type=client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 401
                assert json.loads(r.get_data()).get("error") == "invalid_client"
    
                data = dict(
                    client_id="confidential",
                    client_secret="confidential",
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Retrieve access token using client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 200
    
                data = json.loads(r.get_data())
                assert data["access_token"]
                assert data["token_type"] == "Bearer"
                assert data["scope"] == "test:scope"
                assert data["user"]["id"]
                assert data.get("refresh_token") is None
    
                # Authentication flow has now been completed, and the client can
                # use the access token to make request to the provider.
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=data["access_token"])
                )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'access_token': 'MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'expires_in': 3600,
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 138 bytes [200 OK]&gt;

tests/test_provider.py:433: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'RAW_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a146ac0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'RAW_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a146ac0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f58699ac5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'RAW_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a146ac0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f58699ac5e0&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'RAW_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a146ac0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7f586b333590&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f58699ac5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'RAW_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a146ac0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f58699ac5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'RAW_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f586f600740&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a146ac0&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f58699ac5e0&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (GET, OPTIONS, HEAD) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7f586bf24360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
        uri        = 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7f586ffb2160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=18f0bf3cbb2b45f5_691c3b42.CvzgGj717DB8ixFr8Ap25s_yFkM',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        uri        = 'http://localhost/oauth/info?access_token=MS1bDa2cXI9fbItIKBO60toipzCIbQ'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        token      = 'MS1bDa2cXI9fbItIKBO60toipzCIbQ'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
token = 'MS1bDa2cXI9fbItIKBO60toipzCIbQ', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
tok        = &lt;Token 3&gt;
token      = 'MS1bDa2cXI9fbItIKBO60toipzCIbQ'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_auth_flow_denied" time="0.577" /><testcase classname="tests.test_provider" name="test_personal_access_token" time="0.520" /><testcase classname="tests.test_provider" name="test_resource_auth_methods" time="0.521" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=RegularArg-True]" time="0.461" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[a=1&amp;b=2&amp;c=3-True]" time="0.459" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=text+with+spaces-True]" time="0.562" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=title:TheTitle-True]" time="0.460" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=properly%20encoded%24-True]" time="0.481" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[$type=search-False]" time="0.464" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[q=Joan+D'Arc-False]" time="0.467" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[with regular spaces-False]" time="0.470" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[json_data={a: 42}-False]" time="0.462" /><testcase classname="tests.test_provider" name="test_oauthlib_urldecoding_issue[array=[1, 2, 3]-False]" time="0.465" /><testcase classname="tests.test_provider" name="test_oauthlib_monkeypatch" time="0.465" /><testcase classname="tests.test_provider" name="test_settings_index" time="0.667" /><testcase classname="tests.test_provider" name="test_info_not_accessible_in_production" time="0.546"><failure message="assert 500 == 404&#10; +  where 500 = &lt;WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]&gt;.status_code">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_info_not_accessible_in_production(provider_fixture):
        """Info route should not be available in production mode."""
        app = provider_fixture
        with app.test_request_context():
            with app.test_client() as client:
                app.config.update(
                    DEBUG=False,
                    TESTING=False,
                )
                data = dict(
                    client_id="dev",
                    client_secret="dev",  # A public client should NOT do this!
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Public clients are not allowed to use
                # grant_type=client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 401
                assert json.loads(r.get_data()).get("error") == "invalid_client"
    
                data = dict(
                    client_id="confidential",
                    client_secret="confidential",
                    grant_type="client_credentials",
                    scope="test:scope",
                )
    
                # Retrieve access token using client_credentials
                r = client.post(url_for("invenio_oauth2server.access_token"), data=data)
                assert r.status_code == 200
    
                data = json.loads(r.get_data())
                assert data["access_token"]
                assert data["token_type"] == "Bearer"
                assert data["scope"] == "test:scope"
                assert data.get("refresh_token") is None
                assert data["user"]["id"]
    
                # Authentication flow has now been completed, and the client can
                # use the access token to make request to the provider.
                r = client.get(
                    url_for("invenio_oauth2server.info", access_token=data["access_token"])
                )
&gt;               assert r.status_code == 404
E               assert 500 == 404
E                +  where 500 = &lt;WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]&gt;.status_code

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'access_token': 'QNXVwVx304j60hLpHsfCR05OaYCDkz',
 'expires_in': 3600,
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]&gt;

tests/test_provider.py:739: AssertionError</failure></testcase><testcase classname="tests.test_provider" name="test_expired_refresh_flow" time="0.616"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_expired_refresh_flow(provider_fixture):
        """Test refresh flow with an expired token."""
        app = provider_fixture
        # First login on provider site
        with app.test_request_context():
            with app.test_client() as client:
                login(client)
    
                data = dict(
                    redirect_uri=url_for("oauth2test.authorized", _external=True),
                    scope="test:scope",
                    response_type="code",
                    client_id="confidential",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                assert r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="confidential",
                        client_secret="confidential",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                assert json.loads(r.get_data())["access_token"]
                assert json.loads(r.get_data())["refresh_token"]
                assert json.loads(r.get_data())["expires_in"] &gt; 0
                assert json.loads(r.get_data())["scope"] == "test:scope"
                assert json.loads(r.get_data())["token_type"] == "Bearer"
                assert json.loads(r.get_data())["user"]["id"]
                refresh_token = json.loads(r.get_data())["refresh_token"]
                old_access_token = json.loads(r.get_data())["access_token"]
    
                # Access token valid
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'client_id': 'confidential',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = '2Gd25qsstlC23OGkBj0a39XaqTxD0I'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 189 bytes [200 OK]&gt;
refresh_token = '51X5CpfDgiSlTXGgjsr965NfGTtgcY'
res_data   = {'code': ['8xKz6Z6L5ncAEgpR9enGyh8lEMPDJI'], 'state': ['mystate']}

tests/test_provider.py:793: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'RAW_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f58656e6a70&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'RAW_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f58656e6a70&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869ea6020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'RAW_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f58656e6a70&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869ea6020&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'RAW_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f58656e6a70&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7f5865677440&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869ea6020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'RAW_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f58656e6a70&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869ea6020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'RAW_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869a3be00&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f58656e6a70&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f5869ea6020&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (GET, OPTIONS, HEAD) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7f586bf24360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
        uri        = 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7f586ffb2160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=9bbe183c16273a1f_691c3b4b.IZ65V8NaxZknJPDwpl2ExQ7MHcw',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        uri        = 'http://localhost/oauth/info?access_token=2Gd25qsstlC23OGkBj0a39XaqTxD0I'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        token      = '2Gd25qsstlC23OGkBj0a39XaqTxD0I'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
token = '2Gd25qsstlC23OGkBj0a39XaqTxD0I', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
tok        = &lt;Token 3&gt;
token      = '2Gd25qsstlC23OGkBj0a39XaqTxD0I'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_not_allowed_public_refresh_flow" time="0.727"><failure message="TypeError: can't compare offset-naive and offset-aware datetimes">provider_fixture = &lt;Flask 'testapp'&gt;

    def test_not_allowed_public_refresh_flow(provider_fixture):
        """Public token should not allow refreshing."""
        app = provider_fixture
        # First login on provider site
        with app.test_request_context():
            with app.test_client() as client:
                login(client)
    
                data = dict(
                    redirect_uri=url_for("oauth2test.authorized", _external=True),
                    scope="test:scope",
                    response_type="code",
                    client_id="dev",
                    state="mystate",
                )
    
                r = client.get(url_for("invenio_oauth2server.authorize", **data))
                assert r.status_code == 200
    
                data["confirm"] = "yes"
                data["scope"] = "test:scope"
                data["state"] = "mystate"
    
                # Obtain one time code
                r = client.post(url_for("invenio_oauth2server.authorize"), data=data)
                assert r.status_code == 302
                next_url, res_data = parse_redirect(r.location)
                assert res_data["code"]
                assert res_data["state"] == ["mystate"]
    
                # Exchange one time code for access token
                r = client.post(
                    url_for("invenio_oauth2server.access_token"),
                    data=dict(
                        client_id="dev",
                        client_secret="dev",
                        grant_type="authorization_code",
                        code=res_data["code"],
                    ),
                )
                assert r.status_code == 200
                json_resp = json.loads(r.get_data())
                assert json_resp["access_token"]
                assert json_resp["refresh_token"]
                assert json_resp["expires_in"] &gt; 0
                assert json_resp["scope"] == "test:scope"
                assert json_resp["token_type"] == "Bearer"
                assert json_resp["user"]["id"]
                refresh_token = json_resp["refresh_token"]
                old_access_token = json_resp["access_token"]
    
                # Access token valid
&gt;               r = client.get(
                    url_for("invenio_oauth2server.info", access_token=old_access_token)
                )

app        = &lt;Flask 'testapp'&gt;
client     = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
data       = {'client_id': 'dev',
 'confirm': 'yes',
 'redirect_uri': 'http://localhost/oauth2test/authorized',
 'response_type': 'code',
 'scope': 'test:scope',
 'state': 'mystate'}
json_resp  = {'access_token': 'ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'expires_in': 3600,
 'refresh_token': '4TrJRn7jVO2yFWMJbny1f9XIvLDuCn',
 'scope': 'test:scope',
 'token_type': 'Bearer',
 'user': {'id': '1'}}
next_url   = 'http://localhost/oauth2test/authorized'
old_access_token = 'ZPHeIpEcEO9ppkJksPQp31hcYNBSNj'
provider_fixture = &lt;Flask 'testapp'&gt;
r          = &lt;WrapperTestResponse 189 bytes [200 OK]&gt;
refresh_token = '4TrJRn7jVO2yFWMJbny1f9XIvLDuCn'
res_data   = {'code': ['9mjI9gAI4kHQQ0jVHMWr616cY81SC4'], 'state': ['mystate']}

tests/test_provider.py:897: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/werkzeug/test.py:1162: in get
    return self.open(*args, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^
        args       = ('/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',)
        kw         = {'method': 'GET'}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/flask/testing.py:235: in open
    response = super().open(
        __class__  = &lt;class 'flask.testing.FlaskClient'&gt;
        args       = ('/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',)
        buffered   = False
        follow_redirects = False
        kwargs     = {'environ_base': {'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
                  'REMOTE_ADDR': '127.0.0.1',
                  'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;},
 'method': 'GET'}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1116: in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        arg        = &lt;Request 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET]&gt;
        args       = (&lt;Request 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET]&gt;,)
        buffered   = False
        follow_redirects = False
        kwargs     = {}
        request    = &lt;Request 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET]&gt;
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:988: in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'RAW_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;,
 'werkzeug.request': &lt;Request 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET]&gt;,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a02c950&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;FlaskClient &lt;Flask 'testapp'&gt;&gt;
.venv/lib/python3.12/site-packages/werkzeug/test.py:1264: in run_wsgi_app
    app_rv = app(environ, start_response)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;Flask 'testapp'&gt;
        buffer     = []
        buffered   = False
        environ    = {'HTTP_COOKIE': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'RAW_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a02c950&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        response   = None
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f586a03c360&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1536: in __call__
    return self.wsgi_app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        environ    = {'HTTP_COOKIE': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'RAW_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a02c950&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f586a03c360&gt;
.venv/lib/python3.12/site-packages/werkzeug/middleware/dispatcher.py:81: in __call__
    return app(environ, start_response)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        app        = &lt;bound method Flask.wsgi_app of &lt;Flask 'testapp'&gt;&gt;
        environ    = {'HTTP_COOKIE': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'RAW_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a02c950&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        last_item  = 'oauth'
        original_script_name = ''
        path_info  = '/oauth/info'
        script     = ''
        self       = &lt;werkzeug.middleware.dispatcher.DispatcherMiddleware object at 0x7f5865563050&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f586a03c360&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1514: in wsgi_app
    response = self.handle_exception(e)
               ^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'RAW_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a02c950&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f586a03c360&gt;
.venv/lib/python3.12/site-packages/flask/app.py:1511: in wsgi_app
    response = self.full_dispatch_request()
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        ctx        = &lt;RequestContext 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET] of testapp&gt;
        environ    = {'HTTP_COOKIE': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'HTTP_HOST': 'localhost',
 'HTTP_USER_AGENT': 'Werkzeug/3.1.3',
 'PATH_INFO': '/oauth/info',
 'QUERY_STRING': 'access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'RAW_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'REMOTE_ADDR': '127.0.0.1',
 'REQUEST_METHOD': 'GET',
 'REQUEST_URI': '/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj',
 'SCRIPT_NAME': '',
 'SERVER_NAME': 'localhost',
 'SERVER_PORT': '80',
 'SERVER_PROTOCOL': 'HTTP/1.1',
 'werkzeug.debug.preserve_context': &lt;built-in method append of list object at 0x7f5869e10cc0&gt;,
 'werkzeug.request': None,
 'wsgi.errors': &lt;_io.TextIOWrapper name='&lt;stderr&gt;' mode='w' encoding='utf-8'&gt;,
 'wsgi.input': &lt;_io.BytesIO object at 0x7f586a02c950&gt;,
 'wsgi.multiprocess': False,
 'wsgi.multithread': False,
 'wsgi.run_once': False,
 'wsgi.url_scheme': 'http',
 'wsgi.version': (1, 0)}
        error      = TypeError("can't compare offset-naive and offset-aware datetimes")
        self       = &lt;Flask 'testapp'&gt;
        start_response = &lt;function run_wsgi_app.&lt;locals&gt;.start_response at 0x7f586a03c360&gt;
.venv/lib/python3.12/site-packages/flask/app.py:919: in full_dispatch_request
    rv = self.handle_user_exception(e)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:917: in full_dispatch_request
    rv = self.dispatch_request()
         ^^^^^^^^^^^^^^^^^^^^^^^
        rv         = None
        self       = &lt;Flask 'testapp'&gt;
.venv/lib/python3.12/site-packages/flask/app.py:902: in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req        = &lt;Request 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj' [GET]&gt;
        rule       = &lt;Rule '/oauth/info' (GET, OPTIONS, HEAD) -&gt; invenio_oauth2server.info&gt;
        self       = &lt;Flask 'testapp'&gt;
        view_args  = {}
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:607: in decorated
    valid, req = self.verify_request(scopes)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ()
        f          = &lt;function info at 0x7f586bf24360&gt;
        kwargs     = {}
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:534: in verify_request
    return self.server.verify_request(
        body       = {}
        headers    = {'Cookie': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        scopes     = ('test:scope',)
        self       = &lt;flask_oauthlib.provider.oauth2.OAuth2Provider object at 0x7f586c7eb6b0&gt;
        uri        = 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/base.py:112: in wrapper
    return f(endpoint, uri, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        args       = ('GET',
 {},
 {'Cookie': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
  'Host': 'localhost',
  'User-Agent': 'Werkzeug/3.1.3'},
 ('test:scope',))
        endpoint   = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        f          = &lt;function ResourceEndpoint.verify_request at 0x7f586ffb2160&gt;
        kwargs     = {}
        uri        = 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/endpoints/resource.py:72: in verify_request
    return token_type_handler.validate_request(request), request
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        body       = {}
        headers    = {'Cookie': 'session=7509dff2db622944_691c3b4c.CydFrvvwjGao0AgrPvcwTrw8B24',
 'Host': 'localhost',
 'User-Agent': 'Werkzeug/3.1.3'}
        http_method = 'GET'
        request    = &lt;oauthlib.Request SANITIZED&gt;
        scopes     = ('test:scope',)
        self       = &lt;oauthlib.oauth2.rfc6749.endpoints.pre_configured.Server object at 0x7f586a11d310&gt;
        token_type_handler = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        uri        = 'http://localhost/oauth/info?access_token=ZPHeIpEcEO9ppkJksPQp31hcYNBSNj'
.venv/lib/python3.12/site-packages/oauthlib/oauth2/rfc6749/tokens.py:337: in validate_request
    return self.request_validator.validate_bearer_token(
        request    = &lt;oauthlib.Request SANITIZED&gt;
        self       = &lt;oauthlib.oauth2.rfc6749.tokens.BearerToken object at 0x7f586a0d4c40&gt;
        token      = 'ZPHeIpEcEO9ppkJksPQp31hcYNBSNj'
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
token = 'ZPHeIpEcEO9ppkJksPQp31hcYNBSNj', scopes = ('test:scope',)
request = &lt;oauthlib.Request SANITIZED&gt;

    def validate_bearer_token(self, token, scopes, request):
        """Validate access token.
    
        :param token: A string of random characters
        :param scopes: A list of scopes
        :param request: The Request object passed by oauthlib
    
        The validation validates:
    
            1) if the token is available
            2) if the token has expired
            3) if the scopes are available
        """
        log.debug('Validate bearer token %r', token)
        tok = self._tokengetter(access_token=token)
        if not tok:
            msg = 'Bearer token not found.'
            request.error_message = msg
            log.debug(msg)
            return False
    
        # validate expires
        if tok.expires is not None and \
&gt;               datetime.datetime.now(datetime.timezone.utc) &gt; tok.expires:
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E               TypeError: can't compare offset-naive and offset-aware datetimes

request    = &lt;oauthlib.Request SANITIZED&gt;
scopes     = ('test:scope',)
self       = &lt;flask_oauthlib.provider.oauth2.OAuth2RequestValidator object at 0x7f586a0954c0&gt;
tok        = &lt;Token 3&gt;
token      = 'ZPHeIpEcEO9ppkJksPQp31hcYNBSNj'

.venv/lib/python3.12/site-packages/flask_oauthlib/provider/oauth2.py:864: TypeError</failure></testcase><testcase classname="tests.test_provider" name="test_password_grant_type" time="0.547" /><testcase classname="tests.test_provider" name="test_email_scope" time="0.537" /><testcase classname="tests.test_server" name="ISORT" time="0.009" /><testcase classname="tests.test_server" name="black" time="0.160" /><testcase classname="tests.test_server" name="test_user_identity_init" time="0.526" /><testcase classname="tests.test_settings" name="ISORT" time="0.038" /><testcase classname="tests.test_settings" name="black" time="0.201" /><testcase classname="tests.test_settings" name="test_personal_token_management" time="0.647" /><testcase classname="tests.test_settings" name="test_authorized_app_revocation" time="0.616" /><testcase classname="tests.test_settings" name="test_client_management" time="0.675" /><testcase classname="tests.test_utils" name="ISORT" time="0.014" /><testcase classname="tests.test_utils" name="black" time="0.164" /><testcase classname="tests.test_utils" name="test_rebuilding_access_tokens" time="0.533" /><testcase classname="tests.test_validators" name="ISORT" time="0.016" /><testcase classname="tests.test_validators" name="black" time="0.167" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[example.org/-expected0]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[http://-expected1]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[http://example.org/-expected2]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[https://example.org/-None]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[https://localhost/-None]" time="0.001" /><testcase classname="tests.test_validators" name="test_validate_redirect_uri[https://127.0.0.1-None]" time="0.001" /><testcase classname="tests.test_validators" name="test_url_validator" time="0.566" /><testcase classname="invenio_oauth2server.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_oauth2server.__init__" name="ISORT" time="0.015" /><testcase classname="invenio_oauth2server.__init__" name="black" time="0.163" /><testcase classname="invenio_oauth2server.admin" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_oauth2server.admin" name="ISORT" time="0.018" /><testcase classname="invenio_oauth2server.admin" name="black" time="0.167" /><testcase classname="invenio_oauth2server.alembic.12a88921ada2_create_oauth2server_tables" name="PYDOCSTYLE" time="0.010" /><testcase classname="invenio_oauth2server.alembic.12a88921ada2_create_oauth2server_tables" name="ISORT" time="0.022" /><testcase classname="invenio_oauth2server.alembic.12a88921ada2_create_oauth2server_tables" name="black" time="0.180" /><testcase classname="invenio_oauth2server.alembic.4e57407b8e4a_add_on_delete_cascade" name="PYDOCSTYLE" time="0.008" /><testcase classname="invenio_oauth2server.alembic.4e57407b8e4a_add_on_delete_cascade" name="ISORT" time="0.024" /><testcase classname="invenio_oauth2server.alembic.4e57407b8e4a_add_on_delete_cascade" name="black" time="0.175" /><testcase classname="invenio_oauth2server.alembic.aa546f2a8d2f_create_oauth2server_branch" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_oauth2server.alembic.aa546f2a8d2f_create_oauth2server_branch" name="ISORT" time="0.006" /><testcase classname="invenio_oauth2server.alembic.aa546f2a8d2f_create_oauth2server_branch" name="black" time="0.158" /><testcase classname="invenio_oauth2server.cli" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_oauth2server.cli" name="ISORT" time="0.023" /><testcase classname="invenio_oauth2server.cli" name="black" time="0.180" /><testcase classname="invenio_oauth2server.config" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_oauth2server.config" name="ISORT" time="0.012" /><testcase classname="invenio_oauth2server.config" name="black" time="0.161" /><testcase classname="invenio_oauth2server.decorators" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_oauth2server.decorators" name="ISORT" time="0.016" /><testcase classname="invenio_oauth2server.decorators" name="black" time="0.167" /><testcase classname="invenio_oauth2server.errors" name="PYDOCSTYLE" time="0.009" /><testcase classname="invenio_oauth2server.errors" name="ISORT" time="0.018" /><testcase classname="invenio_oauth2server.errors" name="black" time="0.170" /><testcase classname="invenio_oauth2server.ext" name="PYDOCSTYLE" time="0.029" /><testcase classname="invenio_oauth2server.ext" name="ISORT" time="0.058" /><testcase classname="invenio_oauth2server.ext" name="black" time="0.210" /><testcase classname="invenio_oauth2server.forms" name="PYDOCSTYLE" time="0.014" /><testcase classname="invenio_oauth2server.forms" name="ISORT" time="0.038" /><testcase classname="invenio_oauth2server.forms" name="black" time="0.190" /><testcase classname="invenio_oauth2server.models" name="PYDOCSTYLE" time="0.034" /><testcase classname="invenio_oauth2server.models" name="ISORT" time="0.071" /><testcase classname="invenio_oauth2server.models" name="black" time="0.232" /><testcase classname="invenio_oauth2server.provider" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_oauth2server.provider" name="ISORT" time="0.031" /><testcase classname="invenio_oauth2server.provider" name="black" time="0.181" /><testcase classname="invenio_oauth2server.proxies" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_oauth2server.proxies" name="ISORT" time="0.008" /><testcase classname="invenio_oauth2server.proxies" name="black" time="0.157" /><testcase classname="invenio_oauth2server.scopes" name="PYDOCSTYLE" time="0.002" /><testcase classname="invenio_oauth2server.scopes" name="ISORT" time="0.008" /><testcase classname="invenio_oauth2server.scopes" name="black" time="0.157" /><testcase classname="invenio_oauth2server.theme.semantic.form_styling" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_oauth2server.theme.semantic.form_styling" name="ISORT" time="0.012" /><testcase classname="invenio_oauth2server.theme.semantic.form_styling" name="black" time="0.165" /><testcase classname="invenio_oauth2server.utils" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_oauth2server.utils" name="ISORT" time="0.018" /><testcase classname="invenio_oauth2server.utils" name="black" time="0.167" /><testcase classname="invenio_oauth2server.validators" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_oauth2server.validators" name="ISORT" time="0.023" /><testcase classname="invenio_oauth2server.validators" name="black" time="0.165" /><testcase classname="invenio_oauth2server.views.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_oauth2server.views.__init__" name="ISORT" time="0.006" /><testcase classname="invenio_oauth2server.views.__init__" name="black" time="0.158" /><testcase classname="invenio_oauth2server.views.server" name="PYDOCSTYLE" time="0.013" /><testcase classname="invenio_oauth2server.views.server" name="ISORT" time="0.029" /><testcase classname="invenio_oauth2server.views.server" name="black" time="0.184" /><testcase classname="invenio_oauth2server.views.settings" name="PYDOCSTYLE" time="0.021" /><testcase classname="invenio_oauth2server.views.settings" name="ISORT" time="0.045" /><testcase classname="invenio_oauth2server.views.settings" name="black" time="0.206" /></testsuite></testsuites>