<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="9" skipped="0" tests="100" time="9.864" timestamp="2025-11-18T13:50:01.762546+00:00" hostname="runnervmg1sw1"><testcase classname="docs.conf" name="PYDOCSTYLE" time="0.012" /><testcase classname="docs.conf" name="ISORT" time="0.151" /><testcase classname="docs.conf" name="black" time="0.345" /><testcase classname="tests.conftest" name="PYDOCSTYLE" time="0.012" /><testcase classname="tests.conftest" name="ISORT" time="0.028" /><testcase classname="tests.conftest" name="black" time="0.175" /><testcase classname="tests.data.__init__" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.data.__init__" name="ISORT" time="0.004" /><testcase classname="tests.data.__init__" name="black" time="0.157" /><testcase classname="tests.data.os-v1.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.data.os-v1.__init__" name="ISORT" time="0.004" /><testcase classname="tests.data.os-v1.__init__" name="black" time="0.157" /><testcase classname="tests.data.os-v2.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.data.os-v2.__init__" name="ISORT" time="0.004" /><testcase classname="tests.data.os-v2.__init__" name="black" time="0.156" /><testcase classname="tests.data.v7.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.data.v7.__init__" name="ISORT" time="0.004" /><testcase classname="tests.data.v7.__init__" name="black" time="0.158" /><testcase classname="tests.demo.__init__" name="PYDOCSTYLE" time="0.002" /><testcase classname="tests.demo.__init__" name="ISORT" time="0.004" /><testcase classname="tests.demo.__init__" name="black" time="0.156" /><testcase classname="tests.demo.json_resolver" name="PYDOCSTYLE" time="0.003" /><testcase classname="tests.demo.json_resolver" name="ISORT" time="0.007" /><testcase classname="tests.demo.json_resolver" name="black" time="0.159" /><testcase classname="tests.test_api" name="ISORT" time="0.073" /><testcase classname="tests.test_api" name="black" time="0.250" /><testcase classname="tests.test_api" name="test_indexer_bulk_index" time="0.170" /><testcase classname="tests.test_api" name="test_delete_action" time="0.134" /><testcase classname="tests.test_api" name="test_index_action" time="0.112"><failure message="ValueError: Not naive datetime (tzinfo is already set)">app = &lt;Flask 'testapp'&gt;

    def test_index_action(app):
        """Test index action."""
        with app.app_context():
            record = Record.create({"title": "Test"})
            db.session.commit()
    
            def receiver(sender, json=None, record=None, arguments=None, **kwargs):
                json["extra"] = "extra"
                arguments["pipeline"] = "foobar"
    
            with before_record_index.connected_to(receiver):
&gt;               action = RecordIndexer()._index_action(
                    dict(
                        id=str(record.id),
                        op="index",
                    )
                )

tests/test_api.py:107: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
invenio_indexer/api.py:419: in _index_action
    body = self._prepare_record(record, index, arguments)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
invenio_indexer/api.py:472: in _prepare_record
    pytz.utc.localize(record.created).isoformat() if record.created else None
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 11, 18, 13, 50, 5, 17244, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.test_api" name="test_process_bulk_queue" time="0.129"><failure message="assert 1 == 2&#10; +  where 1 = process_bulk_queue()&#10; +    where process_bulk_queue = &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5eba29c0&gt;.process_bulk_queue&#10; +      where &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5eba29c0&gt; = RecordIndexer()">app = &lt;Flask 'testapp'&gt;
queue = &lt;unbound Queue indexer -&gt; &lt;unbound Exchange indexer(direct)&gt; -&gt; indexer&gt;

    def test_process_bulk_queue(app, queue):
        """Test process indexing."""
        with app.app_context():
            # Create a test record
            r = Record.create({"title": "test"})
            db.session.commit()
            invalid_id2 = uuid.uuid4()
    
            RecordIndexer().bulk_index([r.id, invalid_id2])
            RecordIndexer().bulk_delete([r.id, invalid_id2])
    
            ret = {}
    
            def _mock_bulk(client, actions_iterator, **kwargs):
                ret["actions"] = list(actions_iterator)
                return len(ret["actions"])
    
            with patch("invenio_indexer.api.bulk", _mock_bulk):
                # Invalid actions are rejected
&gt;               assert RecordIndexer().process_bulk_queue() == 2
E               assert 1 == 2
E                +  where 1 = process_bulk_queue()
E                +    where process_bulk_queue = &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5eba29c0&gt;.process_bulk_queue
E                +      where &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5eba29c0&gt; = RecordIndexer()

tests/test_api.py:142: AssertionError</failure></testcase><testcase classname="tests.test_api" name="test_process_bulk_queue_errors" time="0.159"><failure message="assert 0 == 1&#10; +  where 0 = process_bulk_queue()&#10; +    where process_bulk_queue = &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5ebf0f80&gt;.process_bulk_queue&#10; +      where &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5ebf0f80&gt; = RecordIndexer()">app = &lt;Flask 'testapp'&gt;
queue = &lt;unbound Queue indexer -&gt; &lt;unbound Exchange indexer(direct)&gt; -&gt; indexer&gt;

    def test_process_bulk_queue_errors(app, queue):
        """Test error handling during indexing."""
        with app.app_context():
            # Create a test record
            r1 = Record.create({"title": "invalid", "reffail": {"$ref": "#/invalid"}})
            r2 = Record.create(
                {
                    "title": "valid",
                }
            )
            db.session.commit()
    
            RecordIndexer().bulk_index([r1.id, r2.id])
    
            ret = {}
    
            def _mock_bulk(client, actions_iterator, **kwargs):
                ret["actions"] = list(actions_iterator)
                return len(ret["actions"])
    
            with patch("invenio_indexer.api.bulk", _mock_bulk):
                # Exceptions are caught
&gt;               assert RecordIndexer().process_bulk_queue() == 1
E               assert 0 == 1
E                +  where 0 = process_bulk_queue()
E                +    where process_bulk_queue = &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5ebf0f80&gt;.process_bulk_queue
E                +      where &lt;invenio_indexer.api.RecordIndexer object at 0x7f3b5ebf0f80&gt; = RecordIndexer()

tests/test_api.py:168: AssertionError</failure></testcase><testcase classname="tests.test_api" name="test_index" time="0.110"><failure message="ValueError: Not naive datetime (tzinfo is already set)">app = &lt;Flask 'testapp'&gt;

    def test_index(app):
        """Test record indexing."""
        with app.app_context():
            recid = uuid.uuid4()
            record = Record.create({"title": "Test"}, id_=recid)
            db.session.commit()
    
            client_mock = MagicMock()
&gt;           RecordIndexer(search_client=client_mock, version_type="force").index(
                record, arguments={"pipeline": "foobar"}
            )

tests/test_api.py:181: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
invenio_indexer/api.py:472: in _prepare_record
    pytz.utc.localize(record.created).isoformat() if record.created else None
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 11, 18, 13, 50, 5, 575825, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.test_api" name="test_refresh_with_indexer" time="0.084" /><testcase classname="tests.test_api" name="test_refresh_with_indexer_and_prefix" time="0.083" /><testcase classname="tests.test_api" name="test_refresh_with_index_name" time="0.082" /><testcase classname="tests.test_api" name="test_refresh_with_index_obj" time="0.082" /><testcase classname="tests.test_api" name="test_delete" time="0.113" /><testcase classname="tests.test_api" name="test_replace_refs" time="0.083" /><testcase classname="tests.test_api" name="test_bulkrecordindexer_index_delete_by_record_id" time="0.097" /><testcase classname="tests.test_api" name="test_bulkrecordindexer_index_delete_by_record" time="0.109" /><testcase classname="tests.test_api" name="test_before_record_index_dynamic_connect" time="0.119"><failure message="ValueError: Not naive datetime (tzinfo is already set)">app = &lt;Flask 'testapp'&gt;

    def test_before_record_index_dynamic_connect(app):
        """Test before_record_index.dynamic_connect."""
        with app.app_context():
            with patch("invenio_records.api._records_state.validate"):
                auth_record = Record.create(
                    {
                        "$schema": "/records/authorities/authority-v1.0.0.json",
                        "title": "Test",
                    }
                )
                bib_record = Record.create(
                    {
                        "$schema": "/records/bibliographic/bibliographic-v1.0.0.json",
                        "title": "Test",
                    }
                )
                db.session.commit()
    
            def _simple(sender, json=None, **kwargs):
                json["simple"] = "simple"
    
            def _custom(sender, json=None, **kwargs):
                json["custom"] = "custom"
    
            def _cond(sender, connect_kwargs, index=None, **kwargs):
                return "bibliographic" in index
    
            _receiver1 = before_record_index.dynamic_connect(
                _simple, index="records-authorities-authority-v1.0.0"
            )
            _receiver2 = before_record_index.dynamic_connect(_custom, condition_func=_cond)
    
&gt;           action = RecordIndexer()._index_action(dict(id=str(auth_record.id), op="index"))
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_api.py:393: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
invenio_indexer/api.py:419: in _index_action
    body = self._prepare_record(record, index, arguments)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
invenio_indexer/api.py:472: in _prepare_record
    pytz.utc.localize(record.created).isoformat() if record.created else None
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 11, 18, 13, 50, 6, 463420, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.test_api" name="test_indexer_record_class" time="0.001" /><testcase classname="tests.test_cli" name="ISORT" time="0.039" /><testcase classname="tests.test_cli" name="black" time="0.202" /><testcase classname="tests.test_cli" name="test_run" time="0.146" /><testcase classname="tests.test_cli" name="test_reindex" time="0.164"><failure message="opensearchpy.exceptions.NotFoundError: NotFoundError(404, 'index_not_found_exception', 'no such index [records-default-v1.0.0]', records-default-v1.0.0, index_or_alias)">app = &lt;Flask 'testapp'&gt;

    def test_reindex(app):
        """Test reindex."""
        # load records
        with app.test_request_context():
            runner = app.test_cli_runner()
    
            id1 = uuid.uuid4()
            id2 = uuid.uuid4()
            record1 = Record.create(dict(title="Test 1", recid=1), id_=id1)
            record2 = Record.create(dict(title="Test 2", recid=2), id_=id2)
            PersistentIdentifier.create(
                pid_type="recid",
                pid_value=1,
                object_type="rec",
                object_uuid=id1,
                status=PIDStatus.REGISTERED,
            )
            PersistentIdentifier.create(
                pid_type="recid",
                pid_value=2,
                object_type="rec",
                object_uuid=id2,
                status=PIDStatus.REGISTERED,
            )
            db.session.commit()
            indexer = RecordIndexer()
            index = indexer.record_to_index(record1)
    
            # Make sure the index doesn't exist at the beginning (it was not
            # preserved by accident from some other tests)
            assert current_search_client.indices.exists(index) is False
    
            # Initialize queue
            res = runner.invoke(cli.queue, ["init", "purge"])
            assert 0 == res.exit_code
    
            res = runner.invoke(cli.reindex, ["--yes-i-know", "-t", "recid"])
            assert 0 == res.exit_code
            res = runner.invoke(cli.run, [])
            assert 0 == res.exit_code
&gt;           current_search.flush_and_refresh(index)

tests/test_cli.py:79: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/invenio_search/ext.py:249: in flush_and_refresh
    self.client.indices.flush(wait_if_ongoing=True, index=prefixed_index)
.venv/lib/python3.12/site-packages/opensearchpy/client/utils.py:176: in _wrapped
    return func(*args, params=params, headers=headers, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/opensearchpy/client/indices.py:186: in flush
    return self.transport.perform_request(
.venv/lib/python3.12/site-packages/opensearchpy/transport.py:457: in perform_request
    raise e
.venv/lib/python3.12/site-packages/opensearchpy/transport.py:418: in perform_request
    status, headers_response, data = connection.perform_request(
.venv/lib/python3.12/site-packages/opensearchpy/connection/http_urllib3.py:308: in perform_request
    self._raise_error(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;Urllib3HttpConnection: http://localhost:9200&gt;, status_code = 404
raw_data = '{"error":{"root_cause":[{"type":"index_not_found_exception","reason":"no such index [records-default-v1.0.0]","index"...ult-v1.0.0","resource.id":"records-default-v1.0.0","resource.type":"index_or_alias","index_uuid":"_na_"},"status":404}'
content_type = 'application/json'

    def _raise_error(
        self,
        status_code: int,
        raw_data: Union[str, bytes],
        content_type: Optional[str] = None,
    ) -&gt; None:
        """Locate appropriate exception and raise it."""
        error_message = raw_data
        additional_info = None
        try:
            content_type = (
                "text/plain"
                if content_type is None
                else content_type.split(";")[0].strip()
            )
            if raw_data and content_type == "application/json":
                additional_info = json.loads(raw_data)
                error_message = additional_info.get("error", error_message)
                if isinstance(error_message, dict) and "type" in error_message:
                    error_message = error_message["type"]
        except (ValueError, TypeError) as err:
            logger.warning("Undecodable raw error response from server: %s", err)
    
&gt;       raise HTTP_EXCEPTIONS.get(status_code, TransportError)(
            status_code, error_message, additional_info
        )
E       opensearchpy.exceptions.NotFoundError: NotFoundError(404, 'index_not_found_exception', 'no such index [records-default-v1.0.0]', records-default-v1.0.0, index_or_alias)

.venv/lib/python3.12/site-packages/opensearchpy/connection/base.py:315: NotFoundError</failure></testcase><testcase classname="tests.test_cli" name="test_queues_options" time="0.176" /><testcase classname="tests.test_invenio_indexer" name="ISORT" time="0.037" /><testcase classname="tests.test_invenio_indexer" name="black" time="0.194" /><testcase classname="tests.test_invenio_indexer" name="test_version" time="0.001" /><testcase classname="tests.test_invenio_indexer" name="test_init" time="0.005" /><testcase classname="tests.test_invenio_indexer" name="test_hook_initialization" time="0.116"><failure message="ValueError: Not naive datetime (tzinfo is already set)">base_app = &lt;Flask 'testapp'&gt;

    def test_hook_initialization(base_app):
        """Test hook initialization."""
        app = base_app
        magic_hook = MagicMock()
        app.config["INDEXER_BEFORE_INDEX_HOOKS"] = [
            magic_hook,
            "test_invenio_indexer:_global_magic_hook",
        ]
        ext = InvenioIndexer(app)
    
        with app.app_context():
            recid = uuid.uuid4()
            record = Record.create({"title": "Test"}, id_=recid)
            db.session.commit()
    
            client_mock = MagicMock()
&gt;           RecordIndexer(search_client=client_mock, version_type="force").index(record)

tests/test_invenio_indexer.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
invenio_indexer/api.py:472: in _prepare_record
    pytz.utc.localize(record.created).isoformat() if record.created else None
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 11, 18, 13, 50, 7, 746221, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.test_invenio_indexer" name="test_index_prefixing" time="0.142"><failure message="ValueError: Not naive datetime (tzinfo is already set)">base_app = &lt;Flask 'testapp'&gt;

    def test_index_prefixing(base_app):
        """Test index prefixing."""
        app = base_app
        app.config["INDEXER_REPLACE_REFS"] = False
        app.config["SEARCH_INDEX_PREFIX"] = "test-"
        ext = InvenioIndexer(app)
    
        default_index = app.config["INDEXER_DEFAULT_INDEX"]
    
        with app.app_context():
            with patch("invenio_records.api._records_state.validate"):
                record = Record.create({"title": "Test"})
                record2 = Record.create(
                    {
                        "$schema": "/records/authorities/authority-v1.0.0.json",
                        "title": "Test with schema",
                    }
                )
                record3 = Record.create({"title": "Test"})
                record3.delete()
            db.session.commit()
    
            with patch(
                "invenio_indexer.signals.before_record_index.send"
            ) as before_record_index_send:
                client_mock = MagicMock()
&gt;               RecordIndexer(search_client=client_mock).index(record)

tests/test_invenio_indexer.py:117: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
invenio_indexer/api.py:178: in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
invenio_indexer/api.py:472: in _prepare_record
    pytz.utc.localize(record.created).isoformat() if record.created else None
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = &lt;UTC&gt;
dt = datetime.datetime(2025, 11, 18, 13, 50, 7, 891311, tzinfo=datetime.timezone.utc)
is_dst = False

    def localize(self, dt, is_dst=False):
        '''Convert naive time to local time'''
        if dt.tzinfo is not None:
&gt;           raise ValueError('Not naive datetime (tzinfo is already set)')
E           ValueError: Not naive datetime (tzinfo is already set)

.venv/lib/python3.12/site-packages/pytz/__init__.py:245: ValueError</failure></testcase><testcase classname="tests.test_registry" name="ISORT" time="0.011" /><testcase classname="tests.test_registry" name="black" time="0.163" /><testcase classname="tests.test_registry" name="test_indexer_registry" time="0.085" /><testcase classname="tests.test_tasks" name="ISORT" time="0.011" /><testcase classname="tests.test_tasks" name="black" time="0.165" /><testcase classname="tests.test_tasks" name="test_process_bulk_queue" time="0.088" /><testcase classname="tests.test_tasks" name="test_index_record" time="0.083" /><testcase classname="tests.test_tasks" name="test_delete_record" time="0.082" /><testcase classname="tests.test_utils" name="ISORT" time="0.014" /><testcase classname="tests.test_utils" name="black" time="0.165" /><testcase classname="tests.test_utils" name="test_schema_to_index_with_names" time="0.085" /><testcase classname="tests.test_utils" name="test_schema_to_index[records/record-v1.0.0.json-records-record-v1.0.0-None]" time="0.082" /><testcase classname="tests.test_utils" name="test_schema_to_index[/records/record-v1.0.0.json-records-record-v1.0.0-None]" time="0.081" /><testcase classname="tests.test_utils" name="test_schema_to_index[default-v1.0.0.json-default-v1.0.0-None]" time="0.081" /><testcase classname="tests.test_utils" name="test_schema_to_index[default-v1.0.0.json-None-index_names3]" time="0.084" /><testcase classname="tests.test_utils" name="test_schema_to_index[invalidextension-None-None]" time="0.084" /><testcase classname="invenio_indexer.__init__" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_indexer.__init__" name="ISORT" time="0.019" /><testcase classname="invenio_indexer.__init__" name="black" time="0.165" /><testcase classname="invenio_indexer.__init__" name="invenio_indexer" time="0.103"><failure message="068 Now, let's index the record. By default, records are sent to the search engine&#10;069 index defined by the configuration variable ``INDEXER_DEFAULT_INDEX``. This&#10;070 is set to ``None`` by default, to enforce that you always have to specify the&#10;071 index when indexing a record. For now let's set it to a default value and index&#10;072 the record:&#10;073 &#10;074 &gt;&gt;&gt; app.config['INDEXER_DEFAULT_INDEX'] = &quot;records-record-v1.0.0&quot;&#10;075 &gt;&gt;&gt; from invenio_indexer.api import RecordIndexer&#10;076 &gt;&gt;&gt; indexer = RecordIndexer()&#10;077 &gt;&gt;&gt; res = indexer.index(record)&#10;UNEXPECTED EXCEPTION: ValueError('Not naive datetime (tzinfo is already set)')&#10;Traceback (most recent call last):&#10;  File &quot;/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/doctest.py&quot;, line 1368, in __run&#10;    exec(compile(example.source, filename, &quot;single&quot;,&#10;  File &quot;&lt;doctest invenio_indexer[22]&gt;&quot;, line 1, in &lt;module&gt;&#10;  File &quot;/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_indexer/api.py&quot;, line 178, in index&#10;    body = self._prepare_record(record, index, arguments, **kwargs)&#10;           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^&#10;  File &quot;/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_indexer/api.py&quot;, line 472, in _prepare_record&#10;    pytz.utc.localize(record.created).isoformat() if record.created else None&#10;    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^&#10;  File &quot;/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pytz/__init__.py&quot;, line 245, in localize&#10;    raise ValueError('Not naive datetime (tzinfo is already set)')&#10;ValueError: Not naive datetime (tzinfo is already set)&#10;/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_indexer/__init__.py:77: UnexpectedException">068 Now, let's index the record. By default, records are sent to the search engine
069 index defined by the configuration variable ``INDEXER_DEFAULT_INDEX``. This
070 is set to ``None`` by default, to enforce that you always have to specify the
071 index when indexing a record. For now let's set it to a default value and index
072 the record:
073 
074 &gt;&gt;&gt; app.config['INDEXER_DEFAULT_INDEX'] = "records-record-v1.0.0"
075 &gt;&gt;&gt; from invenio_indexer.api import RecordIndexer
076 &gt;&gt;&gt; indexer = RecordIndexer()
077 &gt;&gt;&gt; res = indexer.index(record)
UNEXPECTED EXCEPTION: ValueError('Not naive datetime (tzinfo is already set)')
Traceback (most recent call last):
  File "/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/doctest.py", line 1368, in __run
    exec(compile(example.source, filename, "single",
  File "&lt;doctest invenio_indexer[22]&gt;", line 1, in &lt;module&gt;
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_indexer/api.py", line 178, in index
    body = self._prepare_record(record, index, arguments, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_indexer/api.py", line 472, in _prepare_record
    pytz.utc.localize(record.created).isoformat() if record.created else None
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/.venv/lib/python3.12/site-packages/pytz/__init__.py", line 245, in localize
    raise ValueError('Not naive datetime (tzinfo is already set)')
ValueError: Not naive datetime (tzinfo is already set)
/home/runner/work/invenio-bug-verification/invenio-bug-verification/package-repo/invenio_indexer/__init__.py:77: UnexpectedException</failure></testcase><testcase classname="invenio_indexer.api" name="PYDOCSTYLE" time="0.044" /><testcase classname="invenio_indexer.api" name="ISORT" time="0.077" /><testcase classname="invenio_indexer.api" name="black" time="0.242" /><testcase classname="invenio_indexer.cli" name="PYDOCSTYLE" time="0.016" /><testcase classname="invenio_indexer.cli" name="ISORT" time="0.035" /><testcase classname="invenio_indexer.cli" name="black" time="0.192" /><testcase classname="invenio_indexer.config" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_indexer.config" name="ISORT" time="0.012" /><testcase classname="invenio_indexer.config" name="black" time="0.164" /><testcase classname="invenio_indexer.ext" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_indexer.ext" name="ISORT" time="0.014" /><testcase classname="invenio_indexer.ext" name="black" time="0.168" /><testcase classname="invenio_indexer.proxies" name="PYDOCSTYLE" time="0.003" /><testcase classname="invenio_indexer.proxies" name="ISORT" time="0.008" /><testcase classname="invenio_indexer.proxies" name="black" time="0.163" /><testcase classname="invenio_indexer.registry" name="PYDOCSTYLE" time="0.006" /><testcase classname="invenio_indexer.registry" name="ISORT" time="0.008" /><testcase classname="invenio_indexer.registry" name="black" time="0.170" /><testcase classname="invenio_indexer.signals" name="PYDOCSTYLE" time="0.005" /><testcase classname="invenio_indexer.signals" name="ISORT" time="0.014" /><testcase classname="invenio_indexer.signals" name="black" time="0.169" /><testcase classname="invenio_indexer.tasks" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_indexer.tasks" name="ISORT" time="0.013" /><testcase classname="invenio_indexer.tasks" name="black" time="0.170" /><testcase classname="invenio_indexer.utils" name="PYDOCSTYLE" time="0.007" /><testcase classname="invenio_indexer.utils" name="ISORT" time="0.015" /><testcase classname="invenio_indexer.utils" name="black" time="0.170" /></testsuite></testsuites>