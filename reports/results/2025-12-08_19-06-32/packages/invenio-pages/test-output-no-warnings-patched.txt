 postgresql Pulling 
 redis Pulling 
 opensearch Pulling 
 redis Pulled 
 opensearch Pulled 
 postgresql Pulled 
 Network docker_services_cli_default  Creating
 Network docker_services_cli_default  Created
 Container docker_services_cli-opensearch-1  Creating
 Container docker_services_cli-redis-1  Creating
 Container docker_services_cli-postgresql-1  Creating
 Container docker_services_cli-opensearch-1  Created
 Container docker_services_cli-postgresql-1  Created
 Container docker_services_cli-redis-1  Created
 Container docker_services_cli-postgresql-1  Starting
 Container docker_services_cli-redis-1  Starting
 Container docker_services_cli-opensearch-1  Starting
 Container docker_services_cli-redis-1  Started
 Container docker_services_cli-postgresql-1  Started
 Container docker_services_cli-opensearch-1  Started
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/work/invenio-testrig/invenio-testrig/package-repo
configfile: setup.cfg
testpaths: docs, tests, invenio_pages
plugins: github-actions-annotate-failures-0.3.0, pycodestyle-2.5.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, isort-4.0.0, cov-7.0.0, pydocstyle-2.4.0
collected 138 items

docs/_ext/ultramock.py ...                                               [  2%]
docs/conf.py ...                                                         [  4%]
tests/alembic/test_alembic.py ...                                        [  6%]
tests/conftest.py ...                                                    [  8%]
tests/records/test_records.py ...
.
...
.
..                                 [ 15%]
tests/resources/test_resources.py ...
.
.
.
.
.
..
.
                            [ 23%]
tests/services/test_services.py ...
.
.
.
.
.
.
.
.
.
...                          [ 34%]
tests/test_invenio_pages.py ....                                         [ 37%]
tests/test_views.py ..ssssss                                             [ 43%]
invenio_pages/__init__.py ...                                            [ 45%]
invenio_pages/administration/__init__.py ...                             [ 47%]
invenio_pages/administration/views/__init__.py ...                       [ 50%]
invenio_pages/administration/views/pages.py ...                          [ 52%]
invenio_pages/alembic/__init__.py ...                                    [ 54%]
invenio_pages/alembic/145402e8523a_create_pages_table.py ...             [ 56%]
invenio_pages/alembic/1737449793_add_language_and_new_uq.py ...          [ 58%]
invenio_pages/alembic/98e0a418340d_create_invenio_pages_branch.py ...    [ 60%]
invenio_pages/alembic/9fae3c5404d9_remove_has_custom_view_to_pages.py .. [ 62%]
.                                                                        [ 63%]
invenio_pages/alembic/b0f93ca4a147_add_has_custom_view_to_pages.py ...   [ 65%]
invenio_pages/config.py ...                                              [ 67%]
invenio_pages/ext.py ...                                                 [ 69%]
invenio_pages/proxies.py ...                                             [ 71%]
invenio_pages/records/__init__.py ...                                    [ 73%]
invenio_pages/records/errors.py ...                                      [ 76%]
invenio_pages/records/models.py ...                                      [ 78%]
invenio_pages/resources/__init__.py ...                                  [ 80%]
invenio_pages/resources/config.py ...                                    [ 82%]
invenio_pages/resources/resource.py ...                                  [ 84%]
invenio_pages/services/__init__.py ...                                   [ 86%]
invenio_pages/services/config.py ...                                     [ 89%]
invenio_pages/services/permissions.py ...                                [ 91%]
invenio_pages/services/results.py ...                                    [ 93%]
invenio_pages/services/schemas.py ...                                    [ 95%]
invenio_pages/services/service.py ...                                    [ 97%]
invenio_pages/views.py ...                                               [100%]

=============================== warnings summary ===============================
.venv/lib/python3.12/site-packages/passlib/utils/__init__.py:854
    from crypt import crypt as _crypt

.venv/lib/python3.12/site-packages/marshmallow_utils/fields/generated.py:12
.venv/lib/python3.12/site-packages/marshmallow_utils/fields/generated.py:12
    from marshmallow import __version_info__ as marshmallow_version

.venv/lib/python3.12/site-packages/jsonresolver/contrib/jsonschema.py:31
.venv/lib/python3.12/site-packages/jsonresolver/contrib/jsonschema.py:31
    from jsonschema import RefResolver as _RefResolver

.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver

.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
.venv/lib/python3.12/site-packages/invenio_records/resolver.py:14
    from jsonschema import RefResolutionError, RefResolver

.venv/lib/python3.12/site-packages/fs/__init__.py:4
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/pkg_resources/__init__.py:3146
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(pkg)

.venv/lib/python3.12/site-packages/fs/__init__.py:4
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/fs/opener/__init__.py:6
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__("pkg_resources").declare_namespace(__name__)  # type: ignore

.venv/lib/python3.12/site-packages/pkg_resources/__init__.py:2558
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(parent)

.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/schema.py:154
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/files/schema.py:154: RemovedInMarshmallow4Warning: The 'default' argument to fields is deprecated. Use 'dump_default' instead.
    storage_class = Str(default="L", dump_only=False)

.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/links.py:140
.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/links.py:140
.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/links.py:140
.venv/lib/python3.12/site-packages/invenio_records_resources/services/base/links.py:140
    warnings.warn(

tests/records/test_records.py::test_page_repr
tests/resources/test_resources.py::test_page_content
tests/services/test_services.py::test_page_read
    self.init_app(app)

tests/records/test_records.py::test_page_repr
tests/resources/test_resources.py::test_page_content
tests/services/test_services.py::test_page_read
    self._set_cache(app, config)

    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

    target.updated = datetime.utcnow()

tests/records/test_records.py::test_page_versions
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/tests/records/test_records.py:29: SAWarning: nested transaction already deassociated from connection
    db.session.commit()

tests/records/test_records.py::test_create
tests/resources/test_resources.py::test_create
tests/resources/test_resources.py::test_delete
tests/resources/test_resources.py::test_delete_denied
tests/services/test_services.py::test_create
tests/services/test_services.py::test_delete
tests/services/test_services.py::test_delete_denied
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/invenio_pages/records/models.py:59: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:105: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    return self.schema(context=context, **schema_args).dump(data)

    self._confirmed = datetime.utcnow() if confirmed else None

    warnings.warn(

tests/resources/test_resources.py::test_create
tests/resources/test_resources.py::test_delete
tests/resources/test_resources.py::test_update
tests/resources/test_resources.py::test_create_denied
tests/resources/test_resources.py::test_delete_denied
tests/resources/test_resources.py::test_delete_denied
    _security.datetime_factory(),

tests/resources/test_resources.py::test_create
tests/resources/test_resources.py::test_delete
tests/resources/test_resources.py::test_update
tests/resources/test_resources.py::test_create_denied
tests/resources/test_resources.py::test_delete_denied
tests/resources/test_resources.py::test_delete_denied
tests/resources/test_resources.py::test_delete_denied
    created = datetime.utcnow()

    return cls(int(id_s, 16), datetime.utcfromtimestamp(int(created_s, 16)))

    now = now or datetime.utcnow()

  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/services/records/schema.py:90: RemovedInMarshmallow4Warning: The `context` parameter is deprecated and will be removed in marshmallow 4.0. Use `contextvars.ContextVar` to pass context instead.
    valid_data = self.schema(context=context, **schema_args).load(data)

tests/resources/test_resources.py::test_create
tests/resources/test_resources.py::test_delete
tests/resources/test_resources.py::test_delete_denied
tests/services/test_services.py::test_create
tests/services/test_services.py::test_delete
tests/services/test_services.py::test_delete_denied
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py:193: SAWarning: nested transaction already deassociated from connection
    self.session.commit()

tests/resources/test_resources.py::test_create
tests/services/test_services.py::test_create
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/pytest_invenio/fixtures.py:564: SAWarning: nested transaction already deassociated from connection
    self._transaction.rollback(_to_root=False)

tests/resources/test_resources.py::test_create
tests/services/test_services.py::test_create
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_db/uow.py:212: SAWarning: nested transaction already deassociated from connection
    self.session.commit()

tests/resources/test_resources.py::test_delete
tests/services/test_services.py::test_delete
  /home/runner/work/invenio-testrig/invenio-testrig/package-repo/invenio_pages/records/models.py:128: SAWarning: nested transaction already deassociated from connection
    with db.session.begin_nested():

- generated xml file: /home/runner/work/invenio-testrig/invenio-testrig/artifacts/test-report-patched.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                                                                    Stmts   Miss  Cover   Missing
invenio_pages/__init__.py                                                   4      0   100%
invenio_pages/administration/__init__.py                                    0      0   100%
invenio_pages/administration/views/__init__.py                              0      0   100%
invenio_pages/administration/views/pages.py                                40      0   100%
invenio_pages/alembic/9fae3c5404d9_remove_has_custom_view_to_pages.py      12      0   100%
invenio_pages/alembic/98e0a418340d_create_invenio_pages_branch.py          10      0   100%
invenio_pages/alembic/145402e8523a_create_pages_table.py                   28      0   100%
invenio_pages/alembic/1737449793_add_language_and_new_uq.py                16      0   100%
invenio_pages/alembic/__init__.py                                           0      0   100%
invenio_pages/alembic/b0f93ca4a147_add_has_custom_view_to_pages.py         14      0   100%
invenio_pages/config.py                                                    17      0   100%
invenio_pages/ext.py                                                       51      7    86%   58-66, 75
invenio_pages/proxies.py                                                    6      0   100%
invenio_pages/records/__init__.py                                           2      0   100%
invenio_pages/records/errors.py                                             7      0   100%
invenio_pages/records/models.py                                            82      3    96%   83-84, 145
invenio_pages/resources/__init__.py                                         3      0   100%
invenio_pages/resources/config.py                                          11      0   100%
invenio_pages/resources/resource.py                                        38      0   100%
invenio_pages/services/__init__.py                                          4      0   100%
invenio_pages/services/config.py                                           27      0   100%
invenio_pages/services/permissions.py                                       9      0   100%
invenio_pages/services/results.py                                          38      2    95%   92-93
invenio_pages/services/schemas.py                                          21      0   100%
invenio_pages/services/service.py                                          66      2    97%   117, 131
invenio_pages/views.py                                                     37     20    46%   34, 39-53, 58-65, 81-88, 105-115
TOTAL                                                                     543     34    94%
================ 132 passed, 6 skipped, 330 warnings in 16.85s =================
 Container docker_services_cli-redis-1  Stopping
 Container docker_services_cli-postgresql-1  Stopping
 Container docker_services_cli-opensearch-1  Stopping
 Container docker_services_cli-redis-1  Stopped
 Container docker_services_cli-redis-1  Removing
 Container docker_services_cli-redis-1  Removed
 Container docker_services_cli-postgresql-1  Stopped
 Container docker_services_cli-postgresql-1  Removing
 Container docker_services_cli-postgresql-1  Removed
 Container docker_services_cli-opensearch-1  Stopped
 Container docker_services_cli-opensearch-1  Removing
 Container docker_services_cli-opensearch-1  Removed
 Network docker_services_cli_default  Removing
 Network docker_services_cli_default  Removed
