============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/work/invenio-testrig/invenio-testrig/package-repo
configfile: setup.cfg
testpaths: tests, invenio_app
plugins: github-actions-annotate-failures-0.3.0, pycodestyle-2.5.0, flask-1.3.0, black-ng-0.4.1, invenio-3.4.2, isort-4.0.0, cov-7.0.0, pydocstyle-2.4.0
collected 79 items

tests/conftest.py ...                                                    [  3%]
tests/test_app.py ...
..
.
.
.
.....                                          [ 20%]
tests/test_celery.py ..::error file=package-repo/tests/test_celery.py,line=16::test_celery%0A%0AModuleNotFoundError: No module named 'arrow'
F                                                 [ 24%]
tests/test_cli.py ...
                                                    [ 27%]
tests/test_factory.py ....
.
                                              [ 34%]
tests/test_helpers.py ...
.
.
                                              [ 40%]
tests/test_limiter.py ...
.
.
                                              [ 46%]
tests/test_templating.py ...
.
.
.
                                          [ 54%]
tests/test_wsgi.py ...                                                   [ 58%]
invenio_app/__init__.py ...                                              [ 62%]
invenio_app/celery.py ...                                                [ 65%]
invenio_app/cli.py ...                                                   [ 69%]
invenio_app/config.py ...                                                [ 73%]
invenio_app/ext.py ...                                                   [ 77%]
invenio_app/factory.py ...                                               [ 81%]
invenio_app/helpers.py ...                                               [ 84%]
invenio_app/limiter.py ...                                               [ 88%]
invenio_app/wsgi.py ...                                                  [ 92%]
invenio_app/wsgi_rest.py ...                                             [ 96%]
invenio_app/wsgi_ui.py ...                                               [100%]

=================================== FAILURES ===================================
_________________________________ test_celery __________________________________

    def test_celery():
        """Test celery application."""
        from invenio_app.celery import celery
    
>       celery.loader.import_default_modules()

tests/test_celery.py:16: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
.venv/lib/python3.12/site-packages/celery/loaders/base.py:104: in import_default_modules
    raise response
.venv/lib/python3.12/site-packages/celery/utils/dispatch/signal.py:276: in send
    response = receiver(signal=self, sender=sender, **named)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/invenio_celery/ext.py:116: in celery_module_imports
    app.extensions["invenio-celery"].load_entry_points()
.venv/lib/python3.12/site-packages/invenio_celery/ext.py:73: in load_entry_points
    self.celery.autodiscover_tasks(
.venv/lib/python3.12/site-packages/celery/app/base.py:686: in autodiscover_tasks
    return self._autodiscover_tasks(packages, related_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/celery/app/base.py:693: in _autodiscover_tasks
    return self._autodiscover_tasks_from_names(packages, related_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/celery/app/base.py:698: in _autodiscover_tasks_from_names
    return self.loader.autodiscover_tasks(
.venv/lib/python3.12/site-packages/celery/loaders/base.py:220: in autodiscover_tasks
    mod.__name__ for mod in autodiscover_tasks(packages or (),
.venv/lib/python3.12/site-packages/celery/loaders/base.py:246: in autodiscover_tasks
    return [find_related_module(pkg, related_name) for pkg in packages]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.venv/lib/python3.12/site-packages/celery/loaders/base.py:278: in find_related_module
    raise e
.venv/lib/python3.12/site-packages/celery/loaders/base.py:270: in find_related_module
    return importlib.import_module(module_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/importlib/__init__.py:90: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<frozen importlib._bootstrap>:1387: in _gcd_import
    ???
<frozen importlib._bootstrap>:1360: in _find_and_load
    ???
<frozen importlib._bootstrap>:1331: in _find_and_load_unlocked
    ???
<frozen importlib._bootstrap>:935: in _load_unlocked
    ???
<frozen importlib._bootstrap_external>:999: in exec_module
    ???
<frozen importlib._bootstrap>:488: in _call_with_frames_removed
    ???
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

    # -*- coding: utf-8 -*-
    #
    # Copyright (C) 2021-2024 CERN.
    #
    # Invenio-Records-Resources is free software; you can redistribute it and/or
    # modify it under the terms of the MIT License; see LICENSE file for more
    # details.
    
    """Celery tasks for async processing."""
    
>   import arrow
E   ModuleNotFoundError: No module named 'arrow'

.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py:11: ModuleNotFoundError
------------------------------ Captured log call -------------------------------
ERROR    celery.utils.dispatch.signal:signal.py:280 Signal handler <function celery_module_imports at 0x7fae18800900> raised: ModuleNotFoundError("No module named 'arrow'")
Traceback (most recent call last):
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/utils/dispatch/signal.py", line 276, in send
    response = receiver(signal=self, sender=sender, **named)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_celery/ext.py", line 116, in celery_module_imports
    app.extensions["invenio-celery"].load_entry_points()
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_celery/ext.py", line 73, in load_entry_points
    self.celery.autodiscover_tasks(
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/app/base.py", line 686, in autodiscover_tasks
    return self._autodiscover_tasks(packages, related_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/app/base.py", line 693, in _autodiscover_tasks
    return self._autodiscover_tasks_from_names(packages, related_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/app/base.py", line 698, in _autodiscover_tasks_from_names
    return self.loader.autodiscover_tasks(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/loaders/base.py", line 220, in autodiscover_tasks
    mod.__name__ for mod in autodiscover_tasks(packages or (),
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/loaders/base.py", line 246, in autodiscover_tasks
    return [find_related_module(pkg, related_name) for pkg in packages]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/loaders/base.py", line 278, in find_related_module
    raise e
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/celery/loaders/base.py", line 270, in find_related_module
    return importlib.import_module(module_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/hostedtoolcache/Python/3.12.12/x64/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 999, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/invenio-testrig/invenio-testrig/package-repo/.venv/lib/python3.12/site-packages/invenio_records_resources/tasks.py", line 11, in <module>
    import arrow
ModuleNotFoundError: No module named 'arrow'
=============================== warnings summary ===============================
    warnings.warn(

tests/test_cli.py::test_basic_cli
tests/test_cli.py::test_basic_cli
tests/test_factory.py::test_config_loader
tests/test_factory.py::test_trusted_hosts
tests/test_templating.py::test_notheme
tests/test_templating.py::test_theme
tests/test_templating.py::test_theme_with_instance_templates
tests/test_templating.py::test_list_templaes
    warnings.warn(

tests/test_cli.py::test_basic_cli
tests/test_cli.py::test_basic_cli
tests/test_factory.py::test_config_loader
tests/test_factory.py::test_trusted_hosts
tests/test_templating.py::test_notheme
tests/test_templating.py::test_theme
tests/test_templating.py::test_theme_with_instance_templates
tests/test_templating.py::test_list_templaes
    self._set_cache(app, config)

- generated xml file: /home/runner/work/invenio-testrig/invenio-testrig/artifacts/test-report-patched.xml -
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.12-final-0 _______________

Name                       Stmts   Miss  Cover   Missing
invenio_app/__init__.py        3      0   100%
invenio_app/celery.py          5      0   100%
invenio_app/cli.py             3      0   100%
invenio_app/config.py         29      0   100%
invenio_app/ext.py            62      3    95%   97, 115-116
invenio_app/factory.py        34      2    94%   62-63
invenio_app/helpers.py        55     10    82%   30, 73, 82-87, 111, 113
invenio_app/limiter.py        14      0   100%
invenio_app/wsgi.py            3      0   100%
invenio_app/wsgi_rest.py       2      0   100%
invenio_app/wsgi_ui.py         2      0   100%
TOTAL                        212     15    93%
=========================== short test summary info ============================
FAILED tests/test_celery.py::test_celery - ModuleNotFoundError: No module named 'arrow'
================== 1 failed, 78 passed, 27 warnings in 7.90s ===================
